---
title: MySQL ì¸ë±ìŠ¤ ë ˆì¸ì§€ ìŠ¤ìº”ì„ í†µí•œ ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ ê¸°
date: "2024-11-15"
series: backend trouble shooting
writer: í•˜ì˜¨
tags:
  - Spring
  - MySQL
  - ì¸ë±ìŠ¤
  - í•˜ì˜¨
previewImage: index.png
---

> ğŸ’¡ 2024.11.17 ì¶”ê°€ : ì´ í¬ìŠ¤íŒ…ì—ì„œ ì§„í–‰í•œ ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ ê¸°ëŠ” [ìŠ¤í”„ë§ í˜ì´ì§€ë„¤ì´ì…˜ì—ì„œ ë°œìƒí•œ Latency ì˜ ì›ì¸ê³¼ ì»¤ë²„ë§ ì¸ë±ìŠ¤ ìƒì„±ì„ í†µí•œ ë¬¸ì œ í•´ê²°ê¸°](https://kakaotech-harmony.netlify.app/backend/pagnation-latency-db-covering-index/) ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤. í˜ì´ì§€ë„¤ì´ì…˜ ë¡œì§ì— ëŒ€í•œ ì»¤ë²„ë§ ì¸ë±ìŠ¤ ì ìš©ê¸°ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”! ğŸ™‚

ì˜¤ëœë§Œì˜ í¬ìŠ¤íŒ…ì´ë‹¤. ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„  ëª¨í–‰ ì„œë¹„ìŠ¤ì—ì„œ SLOW QUERY ê°€ ë°œìƒí•œ ë¬¸ì œ ìƒí™©ì„ ì–´ë–»ê²Œ í•´ê²°í–ˆëŠ”ì§€ì— ëŒ€í•´ ë‹¤ë£¨ì–´ë³´ê³ ì í•œë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ì˜ ê°œë…ì™€ íŠ¹ì§•ì— ëŒ€í•´ ë‹¤ì‹œê¸ˆ ê³±ì”¹ì–´ë³´ë©° ì–´ë– í•œ ë°©ì‹ìœ¼ë¡œ ì¸ë±ìŠ¤ë¥¼ ì ìš©í–ˆëŠ”ì§€ì— ëŒ€í•œ ê·¼ê±°ë¥¼ ê³µìœ í•´ë³¼ê¹Œ í•œë‹¤. ë˜í•œ ìš°ë¦¬ ì„œë¹„ìŠ¤ë‚´ì— ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•œ ì‚¬ë¡€ ì¤‘ í•˜ë‚˜ë¥¼ ì¤‘ì ìœ¼ë¡œ ìì„¸íˆ ë‹¤ë£¨ì–´ë³´ê³ ì í•œë‹¤. ì¦‰, ìš°ë¦¬ ì„œë¹„ìŠ¤ë‚´ì— ìƒì„±í•œ ì¸ë±ìŠ¤ ì¢…ë¥˜ì—ëŠ” ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œ ë‹¤ë£° ì¸ë±ìŠ¤ ë‹¨ 1ê°€ì§€ ì¢…ë¥˜ë§Œ ì¡´ì¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ëŠ” ê²ƒì„ ë§í•˜ê³  ì‹¶ë‹¤ ğŸ˜

## ë¬¸ì œ ìƒí™©

ìš°ë¦¬ í•˜ëª¨ë‹ˆ íŒ€ì€ ë†’ì€ **ê°€ìš©ì„±(Availability) í™•ë³´ì™€ ì‚¬ìš©ì ê²½í—˜ì„ í–¥ìƒí•˜ê¸° ìœ„í•´ ë‹¤ì–‘í•œ ì„±ëŠ¥ ê°œì„ ì„ ì‹œë„**í•˜ê³  ìˆë‹¤. ì§€ê¸ˆê¹Œì§€ ë°ì´í„°ë² ì´ìŠ¤ ë ˆí”Œë¦¬ì¼€ì´ì…˜ì„ í†µí•œ ë¶€í•˜ ë¶„ì‚°, ë¡œì»¬ ìºì‹œë¥¼ ì‚¬ìš©í•œ API ìš”ì²­ ìµœì í™”, í†°ìº£ ì„œë²„ íŠœë‹, HikariCP ì ì ˆ ì‚¬ì´ì¦ˆ íŠœë‹, N+1í•´ê²°ë“± ìˆ˜ë§ì€ ë¬¸ì œë¥¼ í•´ê²°í•´ì™”ë‹¤. í•˜ì§€ë§Œ, ê²°êµ­ ë°ì´í„°ë² ì´ìŠ¤ë‚´ì— ëŒ€ëŸ‰ì˜ ë°ì´í„°ê°€ ìŒ“ì¸ë‹¤ë©´ ì—¬ëŸ¬ ì„±ëŠ¥ íŠœë‹ì„ í–ˆìŒì—ë„ **SLOW QUERY** ê°€ ë°œìƒí•  ìˆ˜ ë°–ì— ì—†ë‹¤.


ì‹¤ì œë¡œ ìš°ë¦¬ íŒ€ë‚´ì—ë„ ëŒ€ëŸ‰ì˜ ë”ë¯¸ ë°ì´í„°ë¥¼ ì‚½ì…í•œ ë’¤ ì¿¼ë¦¬ ì†ë„ë¥¼ ì¸¡ì •í•œ ê²°ê³¼ **Long Query** ê°€ ë°œìƒí•˜ê³  ìˆë‹¤. ì´ëŠ” ì‹œìŠ¤í…œë‚´ì— ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒ ìš”ì¸ì´ ë˜ë©°, í•œ ì»¤ë„¥ì…˜ì„ ë¶™ì¡ê³  ìˆëŠ” ì‹œê°„ì´ ê¸¸ì–´ì§€ë¯€ë¡œ ì‹œìŠ¤í…œ ì „ì²´ì— ì„±ëŠ¥ ì €í•˜ì™€ ë³‘ëª© í˜„ìƒì„ ì¼ìœ¼í‚¬ ìˆ˜ ìˆë‹¤. ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ ìƒì„±ì„ í†µí•œ ì¿¼ë¦¬ ì„±ëŠ¥ì„ ê°œì„ í–ˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œ ëŒ€ëŸ‰ì˜ ë”ë¯¸ ë°ì´í„°ë¥¼ ì‚½ì…í•œ ìƒí™©ì†ì—ì„œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•œ ì¿¼ë¦¬ ì ìš© ê³¼ì •, ê³ ë¯¼ ì‚¬í•­ì— ëŒ€í•´ ë‹¤ë£¨ì–´ë³´ê³ ì í•œë‹¤.

## í”Œë˜ë„ˆ API íŠ¹ì„± íŒŒì•…í•˜ê¸°

ìš°ë¦¬ ì„œë¹„ìŠ¤ì—ì„œ í–¥í›„ ì¶œì‹œí•  í”Œë˜ë„ˆ ê³µìœ  ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê³  í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ê³  ìˆë‹¤. ì´ API ëŠ” í–¥í›„ ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥ìœ¼ë¡œ ì¶œì‹œë  í”Œë˜ë„ˆ ê³µìœ  ê¸°ëŠ¥ì— í™œìš©ë  ì˜ˆì •ì´ë‹¤. ëŒ€ëŸ‰ì˜ ë°ì´í„°ì¤‘ ë¹ ë¥´ê²Œ ì›í•˜ëŠ” ì—¬í–‰ ì¼ì •(í”Œë˜ë„ˆ)ë¥¼ ì°¾ì„ ìˆ˜ ìˆë„ë¡ ë“±ë¡ ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ê¸°ëŠ¥ì´ ì¡´ì¬í•œë‹¤. ì•„ë˜ì²˜ëŸ¼ ê²€ìƒ‰í•  ì‹œì‘ë‚ ì§œì™€ ì¢…ë£Œë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê³µê°œëœ (ë¹„ê³µê°œ ìƒíƒœ OFF) ì—¬í–‰ ì¼ì •ì„ ì¡°íšŒí•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•œë‹¤.

![alt text](image-1.png)
 
 ê·¸ëŸ°ë° ë¬¸ì œëŠ”, ëŒ€ëŸ‰ì˜ ë°ì´í„°ê°€ ì‚½ì…ëœ ìƒí™©ì´ë¼ë©´ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ì°¾ì•„ì˜¤ëŠ”ë°ë§Œ **36.839ì´ˆ ë¼ëŠ” ë§¤ìš° ê¸´ ì‹œê°„ì´ ì†Œìš”ëœë‹¤ëŠ” ì ì´ë‹¤.** ì´ ë–„ë¬¸ì— ì‹¤ì œ API ë¥¼ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë´¤ì„ ë•Œ ìê¾¸ë§Œ **Connection Timeout** ì´ ë°œìƒí•œë‹¤. [HikariCP ì™€ ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€(DBCP) ìµœì í™” ê³ ë¯¼í•˜ê¸° - ì´ë¡ í¸](https://kakaotech-harmony.netlify.app/backend/hikaricp-theory/) ì—ì„œ ì„¤ëª…í–ˆë“¯ì´, ìš°ë¦¬ íŒ€ì˜ HikariCP ì»¤ë„¥ì…˜ íƒ€ì„ì•„ì›ƒ ëŒ€ê¸° ì‹œê°„ ì •ì±…ì€ 3ì´ˆë¡œ ì •í•´ì ¸ìˆë‹¤. 3ì´ˆì´ìƒ ì‚¬ìš©ìë¥¼ ëŒ€ê¸°ì‹œí‚¨ë‹¤ë©´ í° ë¶í¸í•¨ì„ ì¤„ ê²ƒì´ë¼ ìƒê°í–ˆê¸° ë•Œë¬¸ì´ë‹¤. 

ê²°êµ­ ì‚¬ìš©ìëŠ” ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ê²€ìƒ‰í•´ì„œ ì°¾ê¸°ìœ„í•´ ëŒ€ê¸°í•˜ëŠ” ì‹œê°„ë§Œ ê¸¸ì–´ì§€ê³ , ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ì§€ ëª»í•œ ëª»í•œ ìƒíƒœë¡œ Timeout ë˜ë²„ë¦°ë‹¤. ì‚¬ìš©ì ê²½í—˜ì—ì„œ ì •ë§ ì¢‹ì§€ ëª»í•˜ë‹¤. ì´ ë¿ë§Œ ì•„ë‹ˆë¼ ì‹œìŠ¤í…œë‚´ì— Slow Query ë¡œ ì¸í•œ ì»¤ë„¥ì…˜ ê³ ê°ˆì´ ë°œìƒí•˜ì—¬ ì„±ëŠ¥ ì €í•˜ì˜ ì£¼ì›ì¸ì´ ë  ìˆ˜ ìˆë‹¤.

## ì‹¤ì œ Long Query ìˆ˜í–‰ì‹œê°„ ì¸¡ì •í•´ë³´ê¸°

ì‹¤ì œë¡œ í”Œë˜ë„ˆ ì¡°íšŒ API ë¥¼ í˜¸ì¶œì‹œ ë‚˜ê°€ëŠ” ì¿¼ë¦¬ë¥¼ í™•ì¸í•´ë³´ì. í…ŒìŠ¤íŠ¸ ì„œë²„ë‚´ì— ìŒ“ì¸ ë°ì´í„° ê±´ìˆ˜ëŠ” ì•„ë˜ì™€ ê°™ì´ **ì•½ 1,600ë§Œê±´ì˜ ë”ë¯¸ë°ì´í„°ê°€ ì €ì¥ëœ ìƒí™©**ì„ì„ ê°€ì •í•œë‹¤.

![alt text](image-3.png)

ë˜í•œ ìŒ“ì¸ ë”ë¯¸ë°ì´í„°ëŠ” ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì„ ì§€ë‹Œë‹¤.

> - ì•½ 1,600ë§Œê±´ì˜ ë°ì´í„°ê°€ ì €ì¥ëœ ìƒí™©
> - 2020ë…„ ~ 2023ë…„ë„ ì‚¬ì´ì˜ ë“±ë¡ëœ ë°ì´í„°ê°€ ê³¨êµ¬ë¡œ ë¶„í¬ëœ ìƒíƒœ (ì¦‰, ì—¬í–‰ ì¼ì • ë“±ë¡ë‚ ì§œê°€ íŠ¹ì • ë…„ë„ì—ë§Œ ë°€ì§‘ëœ ê²ƒì´ ì•„ë‹ˆë¼ ê³¨êµ¬ë¡œ ë¶„ì‚°ë˜ì–´ ìˆë‹¤.)
> - ì´ ì™¸ì—ë„ ì—¬í–‰ ì¼ì •ì˜ name, description í•„ë“œì˜ ë°ì´í„°ë¼ë¦¬ 100ë§Œê°€ì§€ ì´ìƒìœ¼ë¡œ ì„œë¡œ ë‹¤ë¥¸ ê°’ì„ ê°€ì§„ ìƒíƒœ (ì¤‘ë³µë˜ëŠ” ë°ì´í„° ê°’ì„ ìµœì†Œí™”í–ˆë‹¤.)

### ì¿¼ë¦¬ íŠ¹ì„± íŒŒì•…í•˜ê¸°

ì•„ë˜ ì¿¼ë¦¬ëŠ” `WHERE` ì ˆì„ í†µí•´ ì—¬í–‰ ì¼ì • ë“±ë¡ë‚ ì§œ `created_at` ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë²”ìœ„ë‚´ì— í•´ë‹¹í•˜ëŠ” ì—¬í–‰ ì¼ì • ë¦¬ìŠ¤íŠ¸ë¥¼ ì¡°íšŒí•œë‹¤. ìŠ¤í”„ë§ë¶€íŠ¸ ë‚´ì—ì„œ ë¶€í•˜ ë¶„ì‚°ì„ ìœ„í•´ í˜ì´ì§€ë„¤ì´ì…˜ ë¡œì§ì„ ì ìš©í–ˆê¸° ë–„ë¬¸ì— `LIMIT` ê³¼ `OFFSET` ì´ í•¨ê»˜ ë‚˜ê°€ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì¶”ê°€ì ìœ¼ë¡œ `WHERE` ì ˆì—ì„œ `is_private` ì´ë¼ëŠ” boolean í•„ë“œê°€ ì¡´ì¬í•˜ì—¬, ê²€ìƒ‰ì— í™œìš©ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

~~~sql
SELECT name, description, created_at, start_date, end_date, created_at
FROM trip_schedule
WHERE created_at >= '2020-01-01' AND created_at <= '2020-06-01' AND is_private = false
ORDER BY created_at DESC
LIMIT 30 OFFSET 100;
~~~

ì´ë–„ í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©ì„ í†µí•œ `LIMIT` ì¿¼ë¦¬ê°€ ë‚˜ê°„ë‹¤ëŠ” ì ë„ ì¤‘ìš”í•˜ê²Œ ë³¼ ì‚¬í•­ ì¤‘ í•˜ë‚˜ì´ë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ëŠ” ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ íƒ€ì§€ ì•ŠëŠ” ì´ìƒ ë¦¬í”„ í˜ì´ì§€ì˜ ë§¤í•‘ë˜ëŠ” ì‹¤ì œ ë ˆì½”ë“œë¥¼ ì½ì–´ì˜¤ê¸° ìœ„í•´ Random I/O ê°€ ë°œìƒí•  ìˆ˜ ë°–ì— ì—†ë‹¤. 

[MySQL ì—ì„œ B+ Tree ê¸°ë°˜ ì¸ë±ìŠ¤ë¡œ ë°ì´í„°ë¥¼ ìŠ¤ìº”í•˜ëŠ” ë°©ì‹ (ì¸ë±ìŠ¤ ë ˆì¸ì§€ ìŠ¤ìº”)](https://haon.blog/database/index-scan-type/) ì—ì„œ ë‹¤ë£¨ì—ˆë“¯ì´, ëœë¤ I/O ëŠ” ìˆœì°¨ I/O ì— ë¹„í•´ ë¹„ìš©ì´ ê½¤ ë§ì´ ë“œëŠ” ì‘ì—…ì´ë‹¤. ë”°ë¼ì„œ MySQL ì˜µí‹°ë§ˆì´ì €ëŠ” ì‹¤ì œ ë°ì´í„° ë ˆì½”ë“œ ìˆ˜ê°€ ì „ì²´ì—ì„œ 20 ~ 25%ë¥¼ ë„˜ëŠ”ë‹¤ë©´, í…Œì´ë¸”ì˜ ì¸ë±ìŠ¤ë¥¼ íƒ€ì§€ ì•Šê³  ë ˆì½”ë“œë¥¼ ì§ì ‘ ì½ì–´ ìˆœì°¨ I/O ê°€ ë°œìƒí•˜ëŠ” **í…Œì´ë¸” í’€ ìŠ¤ìº”(Table Full Scan)** ë°©ì‹ì„ ìˆ˜í–‰í•˜ë„ë¡ ì¿¼ë¦¬ë¥¼ ìœ ë„í•œë‹¤. ë”°ë¼ì„œ í˜ì´ì§€ë„¤ì´ì…˜ ë¡œì§ì„ ì ìš©í•¨ìœ¼ë¡œì¨ ì½ì–´ì•¼ í•  **ë°ì´í„° ê±´ìˆ˜ê°€ 20~25% ìˆ˜ì¤€ì„ ì ˆëŒ€ ë„˜ì–´ê°€ì§€ ì•Šê³  ì†ŒëŸ‰ì˜ ë°ì´í„°ë§Œ ì½ë„ë¡** í•˜ì—¬, í•­ìƒ ì¸ë±ìŠ¤ë¥¼ íƒ€ë„ë¡ ìŠ¤í”„ë§ë¶€íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì„ ê°œë°œí–ˆë‹¤.

ìœ„ ì¿¼ë¦¬ì— ëŒ€í•œ ì‹¤ì œ ìˆ˜í–‰ì‹œê°„ì„ í™•ì¸í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤. **ì•½ 1,600ë§Œê±´ì˜ ëŒ€ëŸ‰ ë°ì´í„°**ê°€ ì„œë¹„ìŠ¤ë‚´ì— ì €ì¥ëœ ìƒí™©ì´ë¼ë©´ **ì•½ 36.839ì´ˆ** ì´ë¼ëŠ” ë§¤ìš° ê¸´ ì‹œê°„ì´ ì†Œìš”ëœë‹¤. ì´ë ‡ë“¯ ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì§€ ì•Šì€ ìƒí™©ì•„ë¼ë©´ **Slow Query** ê°€ ìˆ˜í–‰ëœë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

![alt text](image-2.png)

## ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•œ ì„±ëŠ¥ ê°œì„  ì‹œë„

ì´ëŸ¬í•œ ë¬¸ì œ ìƒí™©ì´ ë°œìƒí•˜ë¯€ë¡œ, ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ë¥¼ í†µí•œ Slow Query ë¥¼ ì œê±°í•  í•„ìš”ì„±ì„ ëŠë‚„ ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ë¬´í„±ëŒ€ê³  ì¸ë±ìŠ¤ë¥¼ ë§ˆêµ¬ì¡ìœ¼ë¡œ ìƒì„±í•œë‹¤ë©´, ìì¹« ë˜ë ¤ ì„±ëŠ¥ ì €í•˜ì™€ ë¶ˆí•„ìš”í•œ ê³µê°„ ë‚­ë¹„ë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆê¸° ë–„ë¬¸ì— íš¨ìœ¨ì ì¸ ì ìš© ë°©ì•ˆì„ ë§ˆë ¨í•´ì•¼í•œë‹¤. 

### ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ëœë¤ I/O ë¥¼ ìµœì†Œí™”í•˜ê¸°

[ì¿¼ë¦¬ íŠœë‹ì„ ìœ„í•œ HDD ì™€ SSD ì˜ ìˆœì°¨ I/O ì™€ ëœë¤ I/O](https://haon.blog/database/db-index/storage-and-random-sequantial-io/) ì—ì„œ ë‹¤ë£¨ì—ˆë“¯ì´, ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ íŠœë‹ì˜ í•µì‹¬ì€ **Random I/Oë¥¼ ìµœì†Œí™”í•˜ëŠ” ê²ƒì´ë‹¤.** HDD ì˜ ê²½ìš° ëœë¤ I/O ê°€ ë°œìƒí•œë‹¤ë©´ ë””ìŠ¤í¬ë‚´ì— ë¶ˆì—°ì†ì ìœ¼ë¡œ ìœ„ì¹˜í•œ ë°ì´í„°ë¥¼ ì½ê¸°ìœ„í•´ í—¤ë”ë¥¼ ì´ë™ì‹œí‚¤ëŠ” Seek Time ì´ ë°œìƒí•œë‹¤. ì´ Seek Time íšŸìˆ˜ê°€ ë§ì•„ì§ˆ ìˆ˜ë¡ ì„±ëŠ¥ ì €í—ˆê°€ ì‹¬í•´ì§€ê¸° ë–„ë¬¸ì— ì¸ë±ìŠ¤ë¥¼ í†µí•œ ì¿¼ë¦¬ íŠœë‹ì„ ì‹œë„í•´ë³¼ ìˆ˜ ìˆë‹¤. SSD ë˜í•œ HDD ì— ë¹„í•´ ë¹ ë¥´ë‹¤ê³  í•œë“¤, ì¸ë±ìŠ¤ë¥¼ í†µí•œ ì¿¼ë¦¬ ì„±ëŠ¥ íŠœë‹ì´ í•„ìš”í•˜ë‹¤. SSD ë˜í•œ ëœë¤ I/O ê°€ ìˆœì°¨ I/O ì— ë¹„í•´ ì„±ëŠ¥ì´, ì¦‰ ì²˜ë¦¬ìœ¨(throughput)ì´ ê½¤ ëŠë¦¬ë‹¤. SSD ëŠ” ë¬¼ë¦¬ì ìœ¼ë¡œ NAND í”Œë˜ì‹œ ë©”ëª¨ë¦¬ì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ì§ì ‘ ì“°ê³  ì½ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë‚´ë¶€ì ìœ¼ë¡œ ë…¼ë¦¬ì£¼ì†Œë¥¼ ë§¤í•‘í•˜ëŠ” ë§¤í•‘ í…Œì´ë¸”ì„ ì‚¬ìš©í•œë‹¤. ë§¤í•‘ í…Œì´ë¸”ì„ ì—…ë°ì´íŠ¸í•˜ë ¤ë©´ NAND í”Œë˜ì‹œ ë©”ëª¨ë¦¬ì˜ ë¬¼ë¦¬ì ì¸ ë©”ëª¨ë¦¬ë¥¼ ì°¾ì•„ê°¸ì•„ í•˜ë¯€ë¡œ, ëœë¤ I/Oì˜ ê²½ìš° ì´ ê³¼ì •ì— ì¶”ê°€ì ìœ¼ë¡œ ë°œìƒí•˜ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ì´ ëŠë¦¬ë‹¤.

ì¸ë±ìŠ¤ì˜ B+ Tree êµ¬ì¡°ëŠ” í•­ìƒ ì •ë ¬ëœ ìƒíƒœë¥¼ ìœ ì§€í•˜ê¸° ë–„ë¬¸ì— ë¦¬í”„ í˜ì´ì§€ì˜ íƒìƒ‰ ì‹œì‘ì ì„ ë¹ ë¥´ê²Œ ì°¾ì•„ë‚¼ ìˆ˜ ìˆë‹¤. ë˜í•œ ë¦¬í”„ ë…¸ë“œë¼ë¦¬ ì„œë¡œ ë§í¬ë“œë¦¬ìŠ¤íŠ¸ë¡œ ì—°ê²°ë˜ì–´ ìˆê¸° ë–„ë¬¸ì—, ì¸ë±ìŠ¤ ë²”ìœ„ íƒìƒ‰ì´ ê°€ëŠ¥í•˜ë‹¤. (ì´ ë˜í•œ B+ Tree êµ¬ì¡°ì—ì„œ ë¦¬í”„ ë…¸ë“œë¼ë¦¬ë„ ì„œë¡œ ì •ë ¬ëœ ìƒíƒœë¥¼ êµ¬ì„±í•˜ê¸° ë–„ë¬¸ì—, ë¹ ë¥´ê²Œ ë²”ìœ„ íƒìƒ‰ì´ ê°€ëŠ¥í•˜ë‹¤.)

ê·¸ë ‡ë‹¤ë©´ ì•„ë˜ ì¿¼ë¦¬ì—ì„œ ì–´ë–¤ í•„ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•´ì•¼í• ê¹Œ? ìš°ë¦¬ íŒ€ì€ ì–´ë–»ê²Œ ì¸ë±ìŠ¤ë¥¼ ì ìš©í•˜ê¸° ìœ„í•œ ê³ ë¯¼ì´ ìˆì—ˆì„ê¹Œ? ê·¸ ê³ ë¯¼ ì‚¬í•­ì„ í•˜ë‚˜ì”© ì†Œê°œí•´ë³´ê³˜ë‹¤.

~~~sql
SELECT name, description, created_at, start_date, end_date, created_at
FROM trip_schedule
WHERE created_at >= '2020-01-01' AND created_at <= '2020-06-01' AND is_private = false
ORDER BY created_at DESC
LIMIT 30 OFFSET 100;
~~~

## ğŸ¤” 1. ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ í†µí•´ ì„±ëŠ¥ ê°œì„ ì„ ì‹œë„í•´ë³¼ê¹Œ?

> ğŸ’¡ 2024.11.17 ì¶”ê°€ : ì•ì„œ ì–¸ê¸‰í–ˆë“¯ì´, ì´ í¬ìŠ¤íŒ…ì—ì„œ ì§„í–‰í•œ ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ ê¸°ëŠ” [ìŠ¤í”„ë§ í˜ì´ì§€ë„¤ì´ì…˜ì—ì„œ ë°œìƒí•œ Latency ì˜ ì›ì¸ê³¼ ì»¤ë²„ë§ ì¸ë±ìŠ¤ ìƒì„±ì„ í†µí•œ ë¬¸ì œ í•´ê²°ê¸°](https://kakaotech-harmony.netlify.app/backend/pagnation-latency-db-covering-index/) ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤. í˜ì´ì§€ë„¤ì´ì…˜ ë¡œì§ì— ëŒ€í•œ ì»¤ë²„ë§ ì¸ë±ìŠ¤ ì ìš©ê¸°ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”! ğŸ™‚

ì¼ë°˜ì ìœ¼ë¡œ ë””ìŠ¤í¬ì— ì ‘ê·¼í•˜ëŠ” ê·¸ í–‰ìœ„ ìì²´ë¥¼ ì™„ì „íˆ ì œê±°í•˜ê³  ì‹¶ë‹¤ë©´ **ì»¤ë²„ë§ ì¸ë±ìŠ¤**ë¥¼ í†µí•œ ì„±ëŠ¥ ê°œì„ ì„ ìƒê°í•´ë³¼ ìˆ˜ ìˆë‹¤. **ì»¤ë²„ë§ ì¸ë±ìŠ¤**ë€ ì¿¼ë¦¬ë‚´ì— ìˆ˜í–‰ë˜ëŠ” ëª¨ë“  ì»¬ëŸ¼ì„ ì¸ë±ìŠ¤ê°€ ëª¨ë‘ ê°€ì§€ê³  ìˆëŠ” ì¸ë±ìŠ¤ë¥¼ ëœ»í•œë‹¤. ì´ ê²½ìš° ì¸ë±ìŠ¤ê°€ í•„ìš”ë¡œí•˜ëŠ” ëª¨ë“  ë°ì´í„°ë¥¼ ì´ë¯¸ ê°€ì§€ê³  ìˆê¸° ë–„ë¬¸ì—, ì‹¤ì œ ë ˆì½”ë“œì— ì ‘ê·¼í•˜ì—¬ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ëŠ” ëœë¤ I/O ê°€ ì ˆëŒ€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ ì„±ëŠ¥ì´ ë§¤ìš° ë¹¨ë¼ì§„ë‹¤.

~~~sql
ALTER TABLE trip_schedule
ADD INDEX trip_schedule_covering_idx(created_at, is_private, name, description, start_date, end_date);
~~~

ë§Œì•½ ì›Œ ì¿¼ë¦¬ë¥¼ ìœ„í•œ ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•œë‹¤ë©´, ìœ„ì™€ ê¹‰ì´ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤. `created_at`, `name`, `description`, `start_date`, `end_date` ë“± SELECT ì¿¼ë¦¬ë‚´ì— ìš”êµ¬ë˜ëŠ” ëª¨ë“  í•„ë“œì— ëŒ€í•´ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í–ˆë‹¤. 

ì´ë ‡ê²Œ ëœë‹¤ë©´ ëª¨ë“  í•„ë“œê°€ ì¸ë±ìŠ¤ë¥¼ íƒ€ê¸° ë–„ë¬¸ì— ì ˆëŒ€ ë””ìŠ¤í¬ ëœë¤ I/O ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ ë‹¹ì¥ì—” ì„±ëŠ¥ì´ ë§¤ìš° ë¹¨ë¼ì§„ë‹¤. í•˜ì§€ë§Œ [ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ B+ Tree êµ¬ì¡°ëŠ” ì™œ ì¡°íšŒ ì¿¼ë¦¬ ì„±ëŠ¥ì´ ë¹ ë¥¼ê¹Œ?](https://haon.blog/database/index-basic/) ì—ì„œ ë‹¤ë£¨ì—ˆë“¯ì´, ì¸ë±ìŠ¤ëŠ” ì•„ë¬´ê³³ì—ë‚˜ í•„ìš”í•˜ë‹¤ê³  ë§‰ ì ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ, **ì •ë§ í•„ìš”í•œ ìµœì†Œí•œì˜ ì»¬ëŸ¼ì—ë§Œ ì¸ë±ìŠ¤ë¥¼ ì ìš©í•´ì•¼í•œë‹¤.** ì¸ë±ìŠ¤ê°€ ìƒì„±ë˜ëŠ” ì €ì¥ ê³µê°„ì€ ë°ì´í„°ë² ì´ìŠ¤ ì „ì²´ ê³µê°„ì—ì„œ ìµœëŒ€ 10%ë§Œì„ í—ˆìš©í•œë‹¤. ì¦‰, ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ì €ì¥ê³µê°„ì€ í•œì •ì ì´ë¯€ë¡œ ë§ˆêµ¬ì¡ì´ë¡œ ëª¨ë“  ì»¬ëŸ¼ì— ìƒì„±í•´ë²„ë¦¬ë©´ ë¶ˆí•„ìš”í•œ ì €ì¥ ê³µê°„ì„ ë‚­ë¹„í•  ìˆ˜ ìˆë‹¤. ì´ëŸ¬í•œ ì´ìœ ë“¤ë¡œ ì»¤ë²„ë§ ì¸ë±ìŠ¤ëŠ” ìš°ì„  ì ìš©í•˜ì§€ ì•Šê³ , ë” ì í•©í•œ ì¸ë±ìŠ¤ ìƒì„± ë°©ë²•ì„ ì°¾ì•„ë³´ëŠ” ê²ƒì´ ë°”ëŒì§í•˜ê² ë‹¤ íŒë‹¨í–ˆë‹¤.

## ğŸ§ 2. WHERE ì ˆì— í¬í•¨ëœ ëª¨ë“  ì»¬ëŸ¼ì„ í¬í•¨í•œ ë³µí•© ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•´ì•¼í• ê¹Œ? 

ëª¨ë“  ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ë¥¼ ì ìš©í•˜ëŠ” ë°©ë²•ì´ ë‹¤ì†Œ ë¬´ëª¨í•˜ë‹¤ë©´, ëœë¤ I/O ê°€ ë°œìƒí•˜ë”ë¼ë„ **ì¸ë±ìŠ¤ ë ˆì¸ì§€ ìŠ¤ìº”**ì„ í†µí•´ ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ ì„ ì‹œë„í•´ë³¼ ìˆ˜ ìˆë‹¤. **ì¸ë±ìŠ¤ ë ˆì¸ì§€ ìŠ¤ìº”(Index Range Scan)** ì´ë€ ë¦¬í”„ í˜ì´ì§€ì—ì„œ ë²”ìœ„ íƒìƒ‰ì˜ ì‹œì‘ì ë¶€í„° ëì ê¹Œì§€ ìˆœì°¨ëŒ€ë¡œ ë”°ë¼ê°€ë©° ì›í•˜ëŠ” ë°ì´í„°ë“¤ì„ ìŠ¤ìº”í•˜ëŠ” ë°©ì‹ì´ë‹¤. ì´ë•Œ ëœë¤ I/O ê°€ ë°œìƒí•˜ë¯€ë¡œ ì»¤ë²„ë§ ì¸ë±ìŠ¤ì— ë¹„í•´ì„  ìƒëŒ€ì ìœ¼ë¡œ ë‹¤ì†Œ ë¹„íš¨ìœ¨ì ì¼ ìˆ˜ ìˆì§€ë§Œ, **B+ Tree êµ¬ì¡° íŠ¹ì„±ìƒ ì´ ìŠ¤ìº” ë°©ì‹ ë˜í•œ ë§¤ìš° ë¹ ë¥´ê²Œ ë²”ìœ„ íƒìƒ‰ì´ ê°€ëŠ¥í•˜ë‹¤.** ê·¸ë¦¬ê³  `WHERE` ì ˆì— ë‹´ê¸´ í•„ë“œë¥¼ ì¸ë±ìŠ¤ê°€ ìƒì„±ë˜ì–´ì•¼ì§€ ì¸ë±ìŠ¤ ë ˆì¸ì§€ ìŠ¤ìº”ì´ ë°œìƒí•œë‹¤. 

ì•ì„œ ì‚´í´ë³¸ ì¿¼ë¦¬ ë‚´ì—­ì¤‘ì— `WHERE` ì ˆì„ ì¤‘ì ìœ¼ë¡œ ë‹¤ì‹œ ì‚´í´ë³´ì. ì•„ë˜ì™€ ê°™ì´ `created_at`, `is_private` ì„ ëª¨ë‘ `WHERE` ì ˆì— í¬í•¨ëœ ìƒíƒœì´ë‹¤. 

~~~sql
WHERE created_at >= '2020-01-01' 
AND created_at <= '2020-06-01' AND is_private = false
~~~

ë§Œì•½ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•œë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ ìƒì„±í•´ë³´ëŠ” ê²ƒì„ ì‹œë„í•´ë³¼ ìˆ˜ ìˆë‹¤.

~~~sql
ALTER TABLE trip_schedule
ADD INDEX trip_schedule_complex_index(created_at, is_private);
~~~

í•˜ì§€ë§Œ, ì—¬ê¸°ì„œ ìœ„ì²˜ëŸ¼ ë³µí•© ì¸ë±ìŠ¤ë¡œ ìƒì„±í• ì§€, ì•„ë‹ˆë©´ `created_at` ì— ëŒ€í•´ì„œë§Œ ë‹¨ì¼ ì¸ë±ìŠ¤ë¡œ ìƒì„±í• ì§€ ê³ ë¯¼ì´ ë§ì•˜ë‹¤. ë³µí•© ì¸ë±ìŠ¤ë€ ìœ„ì˜ `(created_at, is_private)` ê³¼ ê°™ì´ 2ê°œ ì´ìƒì˜ ì—¬ëŸ¬ ì»¬ëŸ¼ì— ëŒ€í•œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì„ ëœ»í•˜ë©°, ë‹¨ì¼ ì¸ë±ìŠ¤ë€ `(created_at)` ê³¼ ê°™ì´ ë‹¨ 1ê°œì˜ ì»¬ëŸ¼ì— ëŒ€í•´ì„œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ë°©ì‹ì´ë‹¤. 

![alt text](image-4.png)

ì´ˆê¸°ì—ëŠ” ë³µí•© ì¸ë±ìŠ¤ë¥¼ ìœ„ì²˜ëŸ¼ `(created_at, is_private)` ìœ¼ë¡œ ìƒì„±í•˜ê³  ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ ì„ ì‹œë„í•˜ì˜€ë‹¤. ê·¸ ê²°ê³¼ ì‹¤ì œ ì¿¼ë¦¬ ì‹œê°„ì€ ì•½ `55ms` ê°€ ì¸¡ì •ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì•ì„œ ì¸ë±ìŠ¤ë¥¼ ì ìš©í•˜ì§€ ì•Šì•˜ì„ ë•Œì— ë¹„í•˜ë©´ **ì•½ 36.839ì´ˆ** ì—ì„œ **0.055ì´ˆ** ê·¹ëª…í•˜ê²Œ ê°œì„ ë˜ì—ˆë‹¤.

### ë³µí•© ì¸ë±ìŠ¤ vs ë‹¨ì¼ ì¸ë±ìŠ¤

í•˜ì§€ë§Œ ë¬¸ì œì ì´ ìˆë‹¤. ì´ ë˜í•œ ì í•©í•œ ì¸ë±ìŠ¤ ìƒì„± ë°©ì‹ì¼ê¹Œë¼ëŠ” ì˜ë¬¸ì´ ë‚¨ëŠ”ë‹¤ëŠ” ì ì´ë‹¤. ì•ì„  ì»¤ë²„ë§ ì¸ë±ìŠ¤ ê³ ë¯¼ì‚¬í•­ê³¼ ë‹¬ë¦¬ `WHERE` ì ˆì— ë‹´ê¸´ ì»¬ëŸ¼ë§Œìœ¼ë¡œ ì¸ë±ìŠ¤ë¥¼ íƒ€ê²Œ ë˜ì—ˆì§€ë§Œ, `is_private` ì»¬ëŸ¼ì„ í¬í•¨í•œ ë³µí•©  ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ë°”ëŒì§í• ê¹Œ ë¼ëŠ” ì ì´ë‹¤.

ë³µí•© ì¸ë±ìŠ¤ë¥¼ ìƒì„±ì‹œ ì¤‘ìš”í•œ ì ì¤‘ í•˜ë‚˜ëŠ” **ì¹´ë””ë„ë¦¬í‹°(Cardinality)** ì´ë‹¤. ì• ë‹¹ì´ˆ ì¸ë±ìŠ¤ëŠ” ìƒì„±ëœ ì»¬ëŸ¼ë“¤ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ë˜ëŠ”ë°, ë³µí•© ì¸ë±ìŠ¤ë¡œ ìƒì„±ì‹œì—ë„ ë§ˆì°¬ê°€ì§€ë¡œ ìƒì„±ëœ ì»¬ëŸ¼ë“¤ì„ ê¸°ì¤€ìœ¼ë¡œ B+ Tree ê°€ ì •ë ¬ëœë‹¤. ì´ë•Œ **ì¹´ë””ë„ë¦¬í‹°(Cardinality)**ê°€ ë” ë†’ì€(ë” ìœ ë‹ˆí¬í•˜ê³ , ì¤‘ë³µì´ ì ì€) ì»¬ëŸ¼ì„ ì¤‘ì‹¬ìœ¼ë¡œ ë” ì„ í–‰ ì»¬ëŸ¼ìœ¼ë¡œ ë°°ì¹˜í•˜ì—¬ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•´ì•¼í•œë‹¤. ì„ í–‰ëœ ì»¬ëŸ¼ì„ ê¸°ì¤€ìœ¼ë¡œ ì¸ë±ìŠ¤ê°€ ìš°ì„  ì •ë ¬ë˜ê³ , ê·¸ ë‹¤ìŒìœ¼ë¡œ ë°°ì¹˜ëœ ì»¬ëŸ¼ì„ í›„ìˆœìœ„ë¡œí•˜ì—¬ ì¸ë±ìŠ¤ê°€ ì •ë ¬ë˜ê¸° ë–„ë¬¸ì´ë‹¤.

ê·¸ëŸ°ë° ë¬¸ì œëŠ”, ë³µí•© ì¸ë±ìŠ¤ë¡œ ìƒì„±í•œ `(created_at, is_private)` ì—ì„œ `is_private` ì˜ ì¹´ë””ë„ë¦¬í‹°ê°€ ê³¼ì—° ë†’ì€ê°€ì´ë‹¤. `is_private` ì»¬ëŸ¼ì€ true, false ì´ ë‘˜ ì¤‘ í•˜ë‚˜ì˜ ê°’ì„ ê°€ì§€ê¸° ë–„ë¬¸ì— ì¹´ë””ë„ë¦¬í‹°ê°€ ë§¤ìš° ë‚®ì€ ìˆ˜ì¹˜ì´ë‹¤. ì´ë¥¼ ê³ ë ¤í•˜ì—¬ ë³µí•© ì¸ë±ìŠ¤ì˜ ê°€ì¥ ì„ í–‰ë˜ëŠ” 1ë²ˆì§¸ ìˆœì„œê°€ ì•„ë‹Œ 2ë²ˆì§¸ ìˆœì„œë¡œ ë°°ì¹˜í•˜ì˜€ì§€ë§Œ, created_at ì— ë¹„í•´ ë§¤ìš° ë‚®ì€ ì¹´ë””ë„ë¦¬í‹° ìˆ˜ì¹˜ë¥¼ ê°€ì§€ë¯€ë¡œ ì¸ë±ìŠ¤ë¥¼ ì ìš©í•˜ëŠ” ê²ƒì´ ì‚¬ì‹¤ìƒ í° ì„±ëŠ¥ ê°œì„ ì´ ë˜ì§€ ì•ŠëŠ”ë‹¤. `(created_at, is_private)` ì™€ ê°™ì´ ë³µí•© ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•œë‹¤ë©´, `created_at` ì„ ê¸°ë°˜ìœ¼ë¡œ ì„ í–‰ ì •ë ¬ë  ê²ƒì´ë©°, is_private ì„ í›„ìˆœìœ„ë¡œ í•˜ì—¬ ì •ë ¬ë˜ê² ì§€ë§Œ, true / false ë¥¼ ì •ë ¬í•˜ëŠ” ê²ƒì€ ì‚¬ì‹¤ìƒ ë¬´ì˜ë¯¸í•œ í–‰ìœ„ì´ë©°, ë˜ë ¤ ì¸ë±ìŠ¤ ê³µê°„ì„ ë‚­ë¹„í•˜ëŠ” ì…ˆì´ ë  ê²ƒì´ë¼ ìƒê°ë˜ì—ˆë‹¤.

ê·¸ë ‡ë‹¤ê³  í•´ì„œ `is_private` ë¡œ ì¸í•´ ëœë¤ I/O ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ” ê²ƒë„ ì•„ë‹ˆë‹¤. ëœë¤ I/O ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ” ê²ƒì€ ì•ì„  ì»¤ë²„ë§ ì¸ë±ìŠ¤ì¼ ë•Œë§Œ ê°€ëŠ¥í•´ì§„ë‹¤. ë”°ë¼ì„œ ë³µí•© ì¸ë±ìŠ¤ ìƒì„±ì€ ì„±ëŠ¥ ê°œì„ ì´ ë¯¸ë¯¸í•œ í–‰ìœ„ê°€ ë˜ë©°, ë¶ˆí•„ìš”í•œ ì¸ë±ìŠ¤ ê³µê°„ ë‚­ë¹„ê°€ ëœë‹¤.

## ğŸ¯ ë‹¨ì¼ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•œ ì¸ë±ìŠ¤ ë ˆì¸ì§€ ìŠ¤ìº” ìœ ë„

~~~sql
ALTER TABLE trip_schedule
ADD INDEX trip_schedule_simple_index(created_at DESC);
~~~

ê²°êµ­ `(created_at, is_private)` í˜•íƒœì˜ ë³µí•© ì¸ë±ìŠ¤ ìƒì„±ì€ ë¹„íš¨ìœ¨ì ì¸ ì¸ë±ìŠ¤ ìƒì„± ê°œì„  ë°©ë²•ì´ë¼ íŒë‹¨ë˜ì–´, ìœ„ì²˜ëŸ¼ `created_at` ì— ëŒ€í•œ ë‹¨ì¼ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ì„±ëŠ¥ ê°œì„ ì„ ì‹œë„í•˜ì˜€ë‹¤.

ì‹¤ì œë¡œ ì¿¼ë¦¬ê°€ ì¸ë±ìŠ¤ë¥¼ íƒ€ëŠ”ì§€ `EXPLAIN` ëª…ë ¹ì–´, ì¦‰ MySQL ì‹«í–‰ê²Œíšì„ í†µí•´ ì¡°íšŒí•´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ì¡°íšŒëœë‹¤. `type=range` ê°€ ëœ»í•˜ëŠ” ë°”ëŠ” ì¸ë±ìŠ¤ ë ˆì¸ì§€ ìŠ¤ìº”ì´ ìˆ˜í–‰ë¨ì„ ëœ»í•œë‹¤.

![alt text](image-5.png)

ì‹¤ì œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í–ˆì„ ë•Œì˜ ì‹œê°„ì„ ì¸¡ì •í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ìˆ˜í–‰ì‹œê°„ì— **ì•½ 23ms** ë¼ëŠ” ì‹œê°„ì´ ì†Œìš”ë¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì—¬ê¸°ì„œ ì‹ ê¸°í•œì ì€, ì•ì„  ë³µí•© ì¸ë±ìŠ¤ ìƒì„±ë°©ì‹ ë³´ë‹¤ ë˜ë ¤ ìˆ˜í–‰ì‹œê°„ì´ ë¹„ìŠ·í•˜ë‹¤ëŠ” ì ì´ë‹¤. ë¯¸ë¯¸í•œ ìˆ˜ì¤€ì´ì§€ë§Œ, ë˜ë ¤ ìˆ˜í–‰ì‹œê°„ì´ ë” ë¹ ë¥´ê²Œ ì¸¡ì •ë˜ê¸°ë„ í–ˆë‹¤. ì´ë¡œë³´ì•„ is_private ê³¼ ê°™ì´ ì¹´ë””ë„ë¦¬í‹°ê°€ ë§¤ìš° ë‚®ì€ ì»¬ëŸ¼ì— ëŒ€í•´ ì¸ë±ìŠ¤ì— í¬í•¨í•œ ë³µí•© ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•œë‹¤ê³  í•´ì„œ, ê·¸ íš¨ê³¼ëŠ” ì‚¬ì‹¤ìƒ ë¯¸ë¯¸í•˜ê±°ë‚˜ ì—†ë‹¤ê³  ë³´ëŠ” ê²ƒì´ ë§ë‹¤. 

![alt text](image-6.png)

ë¬´ì—‡ë³´ë‹¤ ê¸°ì¡´ **í…Œì´ë¸” í’€ ìŠ¤ìº”(Table Full Scan)** ë°©ì‹ì´ **ì•½ 36.839** ì†Œìš”ì‹œê°„ì´ ìˆ˜í–‰ëœ ê²ƒì— ë¹„í•´, **ì¸ë±ìŠ¤ ë ˆì¸ì§€ ìŠ¤ìº”(Range Scan)** ì„ í†µí•´ ì¿¼ë¦¬ê°€ ì¸ë±ìŠ¤ë¥¼ íƒ€ë‹ˆ **ì•½ 0.023ì´ˆ** ë¡œ ê·¹ëª…í•˜ê²Œ ê°œì„ ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤ ğŸ™‚

## ë§ˆì¹˜ë©°

ì´ë ‡ê²Œ ì¸ë±ìŠ¤ë¥¼ í†µí•œ ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ ê¸°ì— ëŒ€í•´ ë‹¤ë£¨ì–´ë³´ì•˜ë‹¤. ìš°ë¦¬ ì„œë¹„ìŠ¤ë‚´ì— ì í•©í•œ ì¸ë±ìŠ¤ë¥¼ ì ìš©í•˜ê¸° ìœ„í•´ ìœ„ì²˜ëŸ¼ í•˜ë‚˜í•˜ë‚˜ì˜ ë§ì€ ê³ ë¯¼ê³¼ íš¨ìœ¨ì ì¸ í•´ê²°ì•ˆì„ ì°¾ê³ ì ë…¸ë ¥í•˜ì˜€ê³ , ê¸°ì¡´ í…Œì´ë¸” í’€ ìŠ¤ìº” ë°©ì‹ì¼ ë•Œ **ì•½ 36.839ì´ˆ** ê°€ ê±¸ë¦¬ë˜ ì¿¼ë¦¬ë¥¼ **0.023ì´ˆ** ë¡œ ê°œì„ í•˜ì˜€ë‹¤. ë§Œì•½ ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ì ìš©í•œë‹¤ë©´ í˜„ì¬ ì¸¡ì •ëœ ì†Œìš”ì‹œê°„ì¸ **0.023ì´ˆ** ì— ë¹„í•´ ë” ë¹ ë¥¸ ì„±ëŠ¥ì„ ì´ë£¨ì–´ë‚¼ ìˆ˜ ìˆì—ˆê² ì§€ë§Œ, ì´ ì¿¼ë¦¬ ì†Œìš”ì‹œê°„ ë§Œìœ¼ë¡œë„ ì¶©ë¶„íˆ ì¿¼ë¦¬ ì„±ëŠ¥ì´ ê·¹ëª…í•˜ê²Œ ìµœì í™”ë˜ì—ˆë‹¤ê³  ìƒê°í•˜ì—¬ ì»¤ë²„ë§ ì¸ë±ìŠ¤ ìƒì„±ì„ ì ê·¹ ê³ ë ¤í•˜ì§€ ì•Šì•˜ë˜ ê²ƒë„ ì´ìœ  ì¤‘ í•˜ë‚˜ì´ë‹¤. ì„±ëŠ¥ ê°œì„ ì´ ëœë‹¤ê³  í•œë“¤, ê·¸ ìˆ˜ì¤€ì´ ë§¤ìš° ë¯¸ë¯¸í•œ ìˆ˜ì¤€ì¼ ê²ƒì´ë‹¤.

ì•ìœ¼ë¡œë„ ìš°ë¦¬ ì„œë¹„ìŠ¤ ì‚¬ìš©ìë“¤ì´ ë” í¸ë¦¬í•¨ì„ ëˆ„ë¦´ ìˆ˜ ìˆë„ë¡, ì‚¬ìš©ì ê²½í—˜ì„ ê°œì„ í•  ìˆ˜ ìˆë„ë¡ ë§ì€ ê³ ë¯¼ ì‹œê°„ì„ ê°€ì ¸ë³¼ê¹Œ í•œë‹¤. ì´ë§Œ í¬ìŠ¤íŒ…ì„ ë§ˆì³ë³¸ë‹¤ ğŸ˜