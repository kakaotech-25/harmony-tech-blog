---
title: ìŠ¤í”„ë§ í˜ì´ì§€ë„¤ì´ì…˜ì—ì„œ ë°œìƒí•œ Latency ì˜ ì›ì¸ê³¼ ì»¤ë²„ë§ ì¸ë±ìŠ¤ ìƒì„±ì„ í†µí•œ ë¬¸ì œ í•´ê²°ê¸°
date: "2024-11-18"
series: backend trouble shooting
writer: í•˜ì˜¨
tags:
  - Spring
  - MySQL
  - ì¸ë±ìŠ¤
  - í•˜ì˜¨
previewImage: index.png
---

ì´ë²ˆ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… í•´ê²°ê¸°ëŠ” ì§€ë‚œ [MySQL ì¸ë±ìŠ¤ ë ˆì¸ì§€ ìŠ¤ìº”ì„ í†µí•œ ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ ê¸°](https://kakaotech-harmony.netlify.app/backend/index-range-scan-improvement/) ì— ì´ì–´ì§€ëŠ” ë‚´ìš©ì…ë‹ˆë‹¤. ì§€ë‚œ ì¸ë±ìŠ¤ ì ìš©ì„ í†µí•œ ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ ì‹œ ë°œìƒí•œ ë¬¸ì œì ì„ ì–´ë–»ê²Œ ë˜ ë‹¤ì‹œ í•´ê²°í–ˆëŠ”ì§€ë¥¼ ë‹¤ë£¨ëŠ” ê²ƒì´ë¯€ë¡œ, ì§€ë‚œ í¬ìŠ¤íŒ…ì„ ì½ê³ ì˜¤ì‹ ë‹¤ë©´ ì´í•´ì— í° ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤! ğŸ˜

## ë¬¸ì œ ìƒí™©

![alt text](image.png)

ì§€ë‚œ [MySQL ì¸ë±ìŠ¤ ë ˆì¸ì§€ ìŠ¤ìº”ì„ í†µí•œ ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ ê¸°](https://kakaotech-harmony.netlify.app/backend/index-range-scan-improvement/) ì—ì„œ í–¥í›„ ì¶œì‹œë  í”Œë˜ë„ˆ API ë¥¼ ìœ„í•´ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•œ ì¿¼ë¦¬ íŠœë‹ì„ ì‹œë„í–ˆìŠµë‹ˆë‹¤. ì‹¤ì œë¡œ ê·¸ ê²°ê³¼ **ì•½ 36.839ì´ˆ**ê°€ ê±¸ë¦¬ë˜ ì¿¼ë¦¬ë¥¼ **ì•½ 0.023ì´ˆ**ë¡œ í¬ê²Œ ê°ì¶•ì‹œí‚¤ëŠ” ì„±ëŠ¥ ê°œì„ ì„ ì„±ê³µì ìœ¼ë¡œ ì´ë£¨ì–´ëƒˆì£ . í•˜ì§€ë§Œ ë§‰ìƒ API ë¥¼ í…ŒìŠ¤íŠ¸í•´ë³´ë‹ˆ, ê¸°ëŒ€ì™€ ë‹¬ë¦¬ ì¿¼ë¦¬ ì†Œìš”ì‹œê°„ì´ ê°„í˜¹ ê¸¸ê²Œ ì¸¡ì •ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

### ì‹¤ì œ API í˜¸ì¶œ ì‘ë‹µì‹œê°„

![alt text](image-5.png)

Jmeterë¥¼ ì‚¬ìš©í•˜ì—¬ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•œ ê²°ê³¼, ì €í¬ì˜ ê¸°ëŒ€ì²˜ëŸ¼ ì¿¼ë¦¬ íŠœë‹ì´ ì ìš©ëœ ê²½ìš°ì—ëŠ” ì‹¤ì œ APIë¥¼ ìš”ì²­ì‹œ Best Case ì—ì„œ 29ms ê°€ ì¸¡ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ë˜í•œ 100ëª…ì´ ë™ì‹œ ìš”ì²­ì‹œì—ëŠ” í‰ê·  ì‘ë‹µì†ë„ê°€ 552ms ê°€ ì¸¡ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë¡œë³´ì•„, ì²˜ìŒì—ëŠ” ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì´ ì¸ë±ìŠ¤ë¥¼ ì œëŒ€ë¡œ íƒ€ëŠ” ê²ƒìœ¼ë¡œ íŒë‹¨í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

![alt text](image-6.png)

í•˜ì§€ë§Œ, ë¬¸ì œëŠ” ìƒí™©ì— ë”°ë¼ ìœ„ì²˜ëŸ¼ ì†Œìš”ì‹œê°„ì´ ì²œì°¨ë§Œë³„ì´ë¼ëŠ” ì ì…ë‹ˆë‹¤. Best Case ì—ì„œ 29ms ë¼ëŠ” ë§¤ìš° ë¹ ë¥¸ ì†Œìš”ì‹œê°„ì„ ë³´ì´ë˜ ì„±ëŠ¥ì´ ê°„í˜¹ ìœ„ì¹˜ëŸ¼ ê¸´ Latency ê°€ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ ë¬¸ì œëŠ” ë¬´ì—‡ì´ ë¬¸ì œì˜€ì„ê¹Œìš”? ì´ì™€ ê´€ë ¨í•œ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… í•´ê²°ê³¼ ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ ê¸°ë¥¼ ê³µìœ í•´ë³´ê³ ì í•©ë‹ˆë‹¤ ğŸ™‚

## ğŸ’¡ ì‹¤ë§ˆë¦¬ ë°œê²¬

```sql
SELECT name, description, created_at, start_date, end_date, created_at
FROM trip_schedule
WHERE created_at >= '2020-01-01' AND created_at <= '2020-06-01' AND is_private = false
ORDER BY created_at DESC
LIMIT 30 OFFSET 5000;
```

ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” ì›ì¸ì„ ì°¾ê¸°ìœ„í•´ ì´ê²ƒì €ê²ƒì„ ì—¬ëŸ¬ ë°©ì‹ìœ¼ë¡œ ì‹œë„í•´ë´¤ìŠµë‹ˆë‹¤. ë‹¨ì¼ ì¸ë±ìŠ¤ê°€ ì•„ë‹Œ ë³µí•© ì¸ë±ìŠ¤ë¥¼ í†µí•´ ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ ì„ ë‹¤ì‹œ ì‹œë„í•´ë³´ê¸°ë„ í–ˆê³ , `BETWEEN` ì ˆì— ë“¤ì–´ê°€ëŠ” ë²”ìœ„ì˜ ì‹œì‘ê°’ê³¼ ëê°’ì„ ëŠ˜ë¦¬ê³  ì¤„ì—¬ë³´ë©´ì„œ ì›ì¸ì„ ì°¾ì•„ë³´ë ¤ê³  ì‹œë„í–ˆìŠµë‹ˆë‹¤.

### ğŸ¤” ë³µí•© ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì§€ ì•Šì•˜ê¸° ë–„ë¬¸ì¸ê°€...?

ì²˜ìŒì—ëŠ” ë³µí•© ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì§€ ì•Šì•˜ê¸° ë–„ë¬¸ì— ì¿¼ë¦¬ê°€ ê²½ìš°ì— ë”°ë¼ ì†Œìš”ì‹œê°„ì´ ì²œì°¨ë§Œë³„ì¸ ì¤„ ì•Œì•˜ìŠµë‹ˆë‹¤. ì§€ë‚œ ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ ê¸° í¬ìŠ¤íŒ…ì—ì„œ ë‹¤ë£¨ì—ˆë“¯ì´, ì €í¬ëŠ” ì•„ë˜ì²˜ëŸ¼ WHERE ì ˆì—ì„œ ì‚¬ìš©í•˜ëŠ” `created_at` ì— ëŒ€í•´ì„œë§Œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤. ë³µí•© ì¸ë±ìŠ¤ë¡œ ìƒì„±í•˜ì§€ ì•Šì•˜ë˜ ì´ìœ ëŠ” ì§€ë‚œë²ˆì— ìì„¸íˆ ë‹¤ë£¨ì—ˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ìƒëµí•©ë‹ˆë‹¤.

```sql
SELECT name, description, created_at, start_date, end_date, created_at
FROM trip_schedule
WHERE created_at >= '2020-01-01' AND created_at <= '2020-06-01' AND is_private = false
ORDER BY created_at DESC
LIMIT 30 OFFSET 5000;
```

ì´ë²ˆì—ëŠ” WHERE ì ˆì— ì‚¬ìš©ë˜ëŠ” `is_private` ì»¬ëŸ¼ì— ëŒ€í•´ì„œë„ í•¨ê»˜ í¬í•¨ì‹œí‚¨ ë³µí•© ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ì¿¼ë¦¬ ì„±ëŠ¥ ë¬¸ì œë¥¼ í•´ê²°í•´ë³´ê³ ì í–ˆìŠµë‹ˆë‹¤. `is_private` ì»¬ëŸ¼ì€ ì¹´ë””ë„ë¦¬í‹° ìˆ˜ì¹˜ê°€ ë‚®ê¸° ë–„ë¬¸ì— ì¸ë±ìŠ¤ì— í¬í•¨ì‹œí‚¤ì§€ ì•Šì•˜ë˜ ê²ƒì¸ë°, ê²½ìš°ì— ì—ë”°ë¼ ì¸ë±ìŠ¤ë¥¼ ìš´ì´ ì¢‹ê²Œ ì˜ íƒ„ë‹¤ë©´ ì„±ëŠ¥ ê°œì„ ì— ë„ì›€ë˜ì§€ ì•Šì„ê¹Œë¼ëŠ” ê¸°ëŒ€ë¥¼ í•´ë³´ì•˜ì£ .

í•˜ì§€ë§Œ ì´ ë°©ë²• ë˜í•œ ë¬¸ì œì˜ ì›ì¸ì´ ì•„ë‹ˆì˜€ìŠµë‹ˆë‹¤. WHERE ì ˆì— ê±¸ë¦° ëª¨ë“  ì¸ë±ìŠ¤ì— ëŒ€í•œ ë³µí•© ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ë”ë¼ë„ ì„±ëŠ¥ ê°œì„ ì€ ë§¤ìš° ë¯¸ë¯¸í•œ ìƒíƒœì˜€ì£ . ëŒ€ì²´ ë¬´ì—‡ì´ ë¬¸ì œì˜€ì„ê¹Œìš”?

### ğŸ¯ OFFSET ê°’ì´ í´ ë•Œë§Œ ë°œìƒí•˜ëŠ” ë¬¸ì œ

ì´ë ‡ê²Œ ì—¬ëŸ¬ ë°©ë²•ì„ ì‹œë„í•´ë³´ë˜ ì¤‘ ì¬ë°ŒëŠ” ì ì„ í•˜ë‚˜ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. ì‹ ê¸°í•˜ê²Œë„ ë§¨ ë§ˆì§€ë§‰ì— `OFFSET` ì— ë“¤ì–´ê°€ëŠ” ê°’ì„ ëŠ˜ë ¸ë‹¤ê°€ ì¤„ì—¬ë³´ë‹ˆ, `OFFSET` ê°’ì— ë”°ë¼ì„œ ì¿¼ë¦¬ ì†Œìš”ì‹œê°„ì´ ë§¤ìš° ë‹¤ì–‘í•˜ê²Œ ì¸¡ì •ëœë‹¤ëŠ” ì ì…ë‹ˆë‹¤.

ë§Œì•½ `OFFSET` ê°’ì´ ë§¤ìš° ì‘ë‹¤ë©´ ì•ì„  í…ŒìŠ¤íŠ¸ì™€ ê°™ì´ 50ms ì˜ ì†Œìš”ì‹œê°„ì´ ì¸¡ì •ë˜ê¸°ë„ í–ˆìŠµë‹ˆë‹¤. ë°˜ë©´ `OFFSET` ê°’ì´ ë§¤ìš° í¬ë‹¤ë©´, MySQL ì‹¤í–‰ê³„íšì„ í†µí•´ ì¡°íšŒí•œ ê²°ê³¼ ì§€ë‚œë²ˆê³¼ ë™ì¼í•˜ê²Œ 36ì´ˆê°€ ë„˜ëŠ” ì†Œìš”ì‹œê°„ì´ ë¹„ìŠ·í•˜ê²Œ ì¸¡ì •ë˜ê¸°ë„ í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë¡œë³´ì•„, ì´ë²ˆ ì¿¼ë¦¬ ì„±ëŠ¥ ì €í•˜ì˜ ì£¼ë²”ì€ OFFSET ê³¼ ê´€ë ¨ì´ ìˆê² ë‹¤ëŠ” ê°•í•œ í™•ì‹ ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤. OFFSET ê°’ì— ë”°ë¼ì„œ, ìƒí™©ì— ë”°ë¼ í…Œì´ë¸” í’€ ìŠ¤ìº”ê³¼ ë¹„ìŠ·í•˜ê²Œ ì¿¼ë¦¬ê°€ ì¸ë±ìŠ¤ë¥¼ ì˜ íƒ€ì§€ ì•Šê³  ìˆ˜í–‰ë˜ê³  ìˆë‹¤ëŠ” ê°•í•œ ëŠë‚Œì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.

### í˜ì´ì§€ë„¤ì´ì…˜ì„ ì‚¬ìš©í•˜ëŠ” í”Œë˜ë„ˆ API

`OFFSET` ì€ ì–´ë””ì„œ ì‚¬ìš©ë˜ëŠ” ì ˆì¼ê¹Œìš”? ë°”ë¡œ í˜ì´ì§€ë„¤ì´ì…˜ ë¡œì§ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì¿¼ë¦¬ ì ˆì´ëë‹ˆë‹¤. ì €í¬ ì„œë¹„ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” í”Œë˜ë„ˆ API ëŠ” í˜ì´ì§€ë„¤ì´ì…˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. JPA ì—ì„œ ì œê³µí•˜ëŠ” `Pageable` ì„ ì‚¬ìš©í•˜ì—¬ URL ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ìœ¼ë¡œ ì „ë‹¬ë°›ì€ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ `OFFSET` ì„ ì„¤ì •í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì¶”ê°€ì ìœ¼ë¡œ `PageableDefault` ë¥¼ ì‚¬ìš©í•˜ì—¬ LIMIT=30 ì´ ì¿¼ë¦¬ì— ë‚˜ê°€ë„ë¡ ì§€ì •í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

```java
@GetMapping("/search/date")
public ResponseEntity<FindPlannerPublicForCreatedAtRangeResponses> findPublicSchedulesForCreatedAtRange(
                                    @Authentication final Accessor accessor,
                                    @RequestBody final FindPublicSchedulesForRangeRequest findPlannerOrderByDateBetweenRequest,
                                    @PageableDefault(size = 30) final Pageable pageable) {
    return ResponseEntity.ok(plannerService.findPublicSchedulesForCreatedAtRange(findPlannerOrderByDateBetweenRequest, pageable));
}
```

ìœ„ ì½”ë“œë¥¼ ë³´ì‹œë‹¤ì‹œí”¼ í”Œë˜ë„ˆ API ëŠ” í˜ì´ì§€ë„¤ì´ì…˜ì„ ì‚¬ìš©í•˜ë©°, ì´ í˜ì´ì§€ë„¤ì´ì…˜ ë¡œì§ì€ `OFFSET` ì¿¼ë¦¬ì ˆì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì‹¤ì œë¡œ ì•„ë˜ì™€ ê°™ì´ page ì˜µì…˜ì„ ë’¤ì— ë¶™ì—¬ì„œ ì¿¼ë¦¬ê°€ ë‚˜ê°€ë„ë¡ ë™ì‘í•©ë‹ˆë‹¤. ì´ë¡œì¨ ê²°êµ­ ì´ë²ˆ ì¿¼ë¦¬ ì„±ëŠ¥ ë°œìƒ ì €í•˜ì˜ ì£¼ë²”ì€ í˜ì´ì§€ë„¤ì´ì…˜ì„ ê°€ëŠ¥ì„±ì´ ë°˜í™•ì •í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì™œ ëŒ€ì²´ í˜ì´ì§€ë„¤ì´ì…˜ì´ ë¬¸ì œì˜€ì„ê¹Œìš”?

```java
https://ip_address/api/planner/search/date?page=100
```

## ğŸ§µ ì›ì¸ì€ í˜ì´ì§€ë„¤ì´ì…˜ ì•ˆì— ë‹´ê¸´ OFFSET

ìš°ë¦¬ê°€ ë³´í†µ **í˜ì´ì§€ë„¤ì´ì…˜(Pagnation)** ì²˜ë¦¬ë¥¼ ìœ„í•´ í”íˆ ì‚¬ìš©í•˜ëŠ” LIMIT, OFFSET ë°©ì‹ì€ ì–´ë–»ê²Œ ë™ì‘í• ê¹Œìš”? í˜ì´ì§€ë„¤ì´ì…˜ì€ ë§¨ ì•ì—ì„œë¶€í„° ìˆœì°¨ëŒ€ë¡œ OFFSET ê°’ ë§Œí¼ì˜ ëª¨ë“  ROW ë¥¼ ì½ì€ í›„, LIMIT ê°’ ë§Œí¼ì˜ ROW ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ë‹¨ìˆœí•œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì„±ëŠ¥ìƒ í° ë¬¸ì œê°€ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ, ë§ì€ ROW ê°€ ì €ì¥ë˜ì–´ ìˆëŠ” ìƒíƒœì—ì„œ **OFFSET ê°’ì„ ë§¤ìš° í¬ê²Œ ì„¤ì •í•˜ë©´ ì‹¬ê°í•œ ì„±ëŠ¥ ì €í•˜** ë¬¸ì œê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤. ì•„ë˜ ì˜ˆì‹œë¥¼ ì‚´í´ë´…ì‹œë‹¤.

```sql
SELECT * FROM PERSON WHERE id BETWEEN 1 and 100000 LIMIT 3 OFFSET 10; // (1)
SELECT * FROM PERSON WHERE id BETWEEN 1 and 100000 LIMIT 3 OFFSET 10000; // (2)
```

ìœ„ 2ê°œì˜ ì¿¼ë¦¬ëŠ” ëª¨ë‘ WHERE ì ˆì—ì„œ í´ëŸ¬ìŠ¤í„°ë§ ì¸ë±ìŠ¤ê°€ ìë™ ìƒì„±ëœ PK ê°’ì„ í†µí•´ ë²”ìœ„ íƒìƒ‰ì„ ì‹œë„í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë˜í•œ LIMIT, OFFSET ì ˆì„ í†µí•œ í˜ì´ì§€ë„¤ì´ì…˜ ì²˜ë¦¬ë¥¼ ì‹œë„í•˜ê³  ìˆì£ . ë‘˜ì˜ ê°€ì¥ í° ì°¨ì´ì ì€ OFFSET ê°’ì´ ë‹¤ë¥´ë‹¤ëŠ” ì ì…ë‹ˆë‹¤. `(1)` ì˜ ê²½ìš° 10ë²ˆì§¸ í˜ì´ì§€ë¶€í„° 3ê°œì˜ ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ê¸° ìœ„í•´ ë§¨ ì•ì—ì„œë¶€í„° 10ê°œì˜ í–‰ì„ ê±°ì³ì„œ ì´ë™í•´ì•¼í•©ë‹ˆë‹¤. ë°˜ë©´ `(2)` ì˜ ê²½ìš° ë§¨ ì•ì—ì„œë¶€í„° 10,000ê°œì˜ í–‰ì„ ê±°ì³ì„œ ì´ë™í•´ì•¼í•©ë‹ˆë‹¤. ë‹¹ì—°í•˜ê²Œë„, `(1)` ì— ë¹„í•´ `(2)` ê°€ ì½ì–´ë“¤ì´ë©° ì´ë™í•´ì•¼ í•˜ëŠ” ë²”ìœ„ê°€ ë§¤ìš° í¬ê¸° ë–„ë¬¸ì— ì„±ëŠ¥ì´ ë” ë‚˜ì©ë‹ˆë‹¤. ì•ì„œ ì„¤ëª…í–ˆë“¯ì´, í˜ì´ì§•ì€ ë§¨ ì•ì—ì„œë¶€í„° ìˆœì°¨ëŒ€ë¡œ ëª¨ë“  í–‰ì„ ì½ê³ ë‚œ ë’¤ì—, ê·¸ì œì„œì•¼ LIMIT ë§Œí¼ì˜ í–‰ì„ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹ìœ¼ë¡œ ë™ì‘í•˜ê¸° ë–„ë¬¸ì´ì£ .

### Random I/O ê°€ ë°œìƒí•˜ëŠ” í˜ì´ì§€ë„¤ì´ì…˜

ì´ì „ í¬ìŠ¤íŒ…ì—ì„œ ë‹¤ë£¨ì—ˆë“¯ì´, ì €í¬ëŠ” `created_at` ì— ëŒ€í•´ì„œë§Œ ë‹¨ì¼ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ë ‡ê²Œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•  ê²½ìš°ì˜ ë¬¸ì œì ì€, ì»¤ë²„ë§ ì¸ë±ìŠ¤ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— **Random I/O** ê°€ ë°œìƒí•œë‹¤ëŠ” ì ì…ë‹ˆë‹¤.

```sql
SELECT name, description, created_at, start_date, end_date, created_at
FROM trip_schedule
WHERE created_at >= '2020-01-01' AND created_at <= '2020-06-01' AND is_private = false
ORDER BY created_at DESC
LIMIT 30 OFFSET 5000;
```

MySQL ì˜ LIMIT ì ˆì˜ íŠ¹ì„±ì€, LIMIT ì ˆì—ì„œ í•„ìš”í•œ ë ˆì½”ë“œ ê±´ìˆ˜ë§Œ ì¤€ë¹„ë˜ë©° ì¦‰ì‹œ ì¿¼ë¦¬ë¥¼ ì¢…ë£Œí•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. í•˜ì§€ë§Œ, ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì§€ ì•ŠëŠ” ì¼ë°˜ì ì¸ ëª¨ë“  ì¡°íšŒ ì¿¼ë¦¬ëŠ” LIMIT - OFFSET ì„ ìˆ˜í–‰í•  ë•Œ ì‹¤ì œ ë ˆì½”ë“œì— ì ‘ê·¼í•˜ëŠ” Random I/O ê°€ ë°œìƒí•©ë‹ˆë‹¤. ì¦‰, ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¡œ ì²˜ë¦¬í•  ìˆ˜ ì—†ëŠ” ì¡°íšŒ ì¿¼ë¦¬ëŠ” í…Œì´ë¸”ì˜ ì‹¤ì œ ë ˆì½”ë“œë¥¼ ë§¨ ì²˜ìŒë¶€í„° OFFSET ê°’ ë§Œí¼ì˜ ëª¨ë“  ë ˆì½”ë“œë¥¼ ì½ì–´ì•¼í•©ë‹ˆë‹¤. ìœ„ ì¿¼ë¦¬ì˜ ê²½ìš° 5,000ê±´ì˜ ì‹¤ì œ ë ˆì½”ë“œë¥¼ ì½ëŠ” Random I/O ê°€ ë°œìƒí•©ë‹ˆë‹¤. ê·¸ë ‡ê²Œ ì½ì€ 5,000ê±´ì˜ ë°ì´í„°ëŠ” ëª¨ë‘ ë²„ë¦¬ê³  ë§ˆì§€ë§‰ 30ê±´ë§Œ ì‚¬ìš©ìì—ê²Œ ê²°ê³¼ê°’ì„ ë°˜í™˜í•˜ê²Œ ë©ë‹ˆë‹¤. ì¦‰, **OFFSETì˜ ìˆ˜ì¹˜ê°€ ì»¤ì§ˆìˆ˜ë¡ Random I/O ì˜ ë°œìƒíšŸìˆ˜ëŠ” ë¹„ë¡€í•´ì„œ ì¦ê°€**í•˜ê³ , ì´ ë–„ë¬¸ì— ìƒë‹¹íˆ ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦¬ê²Œ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

## ì»¤ë²„ë§ ì¸ë±ìŠ¤ vs ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§•

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ëŒ€í‘œì ì¸ 2ê°€ì§€ ë°©ë²•ì´ ì¡´ì¬í•©ë‹ˆë‹¤. í•˜ë‚˜ëŠ” `(1)` ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ Random I/O ë¥¼ ì œê±°í•˜ëŠ” ë°©ì‹ì´ê³ , ë‹¤ë¥¸ í•˜ë‚˜ëŠ” `(2)` ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§• ê¸°ë²•ì„ ì ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ê¶Œì¥í•˜ëŠ” ë°©ë²•ì€ `(2)` ë°©ì‹ì• ì»¤ë²„ ê¸°ë°˜ í˜ì´ì§• ë°©ì‹ì…ë‹ˆë‹¤. ì´ ì»¤ë²„ ê¸°ë°˜ í˜ì´ì§• ë°©ì‹ì´ë€ ë¬´ì—‡ì¼ê¹Œìš”?

### ì»¤ë²„ ê¸°ë°˜ í˜ì´ì§• (Cursor Based Paging)

ì»¤ë²„ ê¸°ë°˜ í˜ì´ì§• ë°©ì‹ì´ë€ `OFFSET` í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒìœ¼ë¡œ, ì»¤ì„œ ê°’ì„ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë§¤ë²ˆ ì¼ì¼ì´ ì €ì¥í•´ë‘ì—ˆë‹¤ê°€ ë‹¤ìŒ í˜ì´ì§€ëŠ” ê°€ì ¸ì˜¤ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ì•„ë˜ ì½”ë“œëŠ” ì €í¬ì˜ OFFSET ê¸°ë°˜ ì¿¼ë¦¬ë¬¸ì„ ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§•ìœ¼ë¡œ ë³€í™˜í•œ ì¿¼ë¦¬ë¬¸ì…ë‹ˆë‹¤.

```sql
SELECT name, description, created_at, start_date, end_date
FROM trip_schedule
WHERE created_at < {ì»¤ì„œê°’}
  AND created_at >= '2020-01-01'
  AND created_at <= '2020-06-01'
  AND is_private = false
ORDER BY created_at DESC
LIMIT 30;
```

ê°€ì¥ ë³€í™”ëœ ì§€ì ì€ ë°”ë¡œ WHERE ì ˆì— ID ê°’ì´ ì¶”ê°€ë˜ì—ˆìœ¼ë©°, OFFSET ì´ ì—†ì–´ì¡Œë‹¤ëŠ” ì ì…ë‹ˆë‹¤. ì´ë ‡ë“¯ ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§•ì€ OFFSET ì„ ì œê±°í•œ ë°©ì‹ì…ë‹ˆë‹¤. ê·¸ ëŒ€ì‹ ì— ë‹¨ì ì€, í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë§¤ë²ˆ ì¼ì¼ì´ ì–´ë–¤ ì§€ì ì—ì„œë¶€í„° ë˜ ë‹¤ì‹œ ë‹¤ìŒ í˜ì´ì§€ ë°ì´í„°ë“¤ì„ ì½ì–´ë“¤ì–´ì•¼ í• ì§€ í•­ìƒ ê¸°ì–µí•˜ê³  ìˆì–´ì•¼í•œë‹¤ëŠ” ì ì…ë‹ˆë‹¤. ì´ë•Œ **ì»¤ì„œ(Cursor)** ë€ ìœ„ì²˜ëŸ¼ ID ê°’ì´ ë  ê²ƒì…ë‹ˆë‹¤. ì»¤ì„œë€ ë§ ê·¸ëŒ€ë¡œ í¬ì¸í„°ì™€ ê°™ì€ ê²ƒìœ¼ë¡œ, í•œë²ˆ ë°ì´í„°ë¥¼ LIMIT ë§Œí¼ ì½ì–´ë“¤ì¸ ë’¤ ë˜ ë‹¤ì‹œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•´ ê·¸ ìœ„ì¹˜ ê°’ì„ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì €ì¥í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

### ğŸ˜¤ ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§•ì„ ë„ì…í•˜ì§€ ì•Šì€ ì´ìœ 

ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§•ì€ ì •ë§ ì¢‹ì€ ë°©ì‹ì…ë‹ˆë‹¤. OFFSET ì„ ì‚¬ìš©í•˜ì§€ ì•Šê¸° ë–„ë¬¸ì— ì¿¼ë¦¬ ì„±ëŠ¥ì´ ë§¤ìš° ë¹¨ë¼ì§„ë‹¤ëŠ” ì ì´ ì¡´ì¬í•˜ì£ . OFFSET ë°©ì‹ì—ì„œëŠ” ì›í•˜ëŠ” ì†ŒëŸ‰ì˜ ë°ì´í„°ë¥¼ ì½ê¸° ìœ„í•´ OFFSET ê°€ ì»¤ì§ˆìˆ˜ë¡ ë¶ˆí•„ìš”í•˜ê²Œ Random I/O ê°€ ë§ì´ ë°œìƒí•œë‹¤ëŠ” ì¹˜ëª…ì ì¸ ë¬¸ì œì ì´ ì¡´ì¬í–ˆìŠµë‹ˆë‹¤. ë°˜ë©´, ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§•ì€ LIMIT ë§Œí¼ì— ëŒ€í•´ì„œë§Œ Random I/O ê°€ ë°œìƒí•˜ë¯€ë¡œ, ì„±ëŠ¥ ì €í•˜ë¥¼ ìš°ë ¤í•  í•„ìš”ê°€ ì—†ì£ .

í•˜ì§€ë§Œ ë¬¸ì œëŠ”, ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§•ë°©ì‹ì€ ì´ì „ í˜ì´ì§€(ì»¤ì„œ) ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ìŒì— ì½ì–´ë“¤ì¼ ë°ì´í„°ë¥¼ í˜ì´ì§•í•˜ê¸° ë–„ë¬¸ì—, **íŠ¹ì • í˜ì´ì§€ë¡œ ê±´ë„ˆ ë›°ì–´ì„œ ë„˜ì–´ê°ˆ ìˆ˜ ì—†ë‹¤ëŠ” í•œê³„ì **ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì¦‰, ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§•ì€ **ê³§ ë°”ë¡œ ë‹¤ìŒ í˜ì´ì§€ë¡œë§Œ ì´ë™ ê°€ëŠ¥í•˜ë‹¤ëŠ” ë¬¸ì œì **ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ë¬´í•œ ìŠ¤í¬ë¡¤ì´ë‚˜ More ë²„íŠ¼ì´ ìˆëŠ” í˜•íƒœë¡œë§Œ í˜ì´ì§• ê¸°ëŠ¥ì„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.

ë¬´ì—‡ë³´ë‹¤ ì €í¬ í”Œë˜ë„ˆ API ì— ì‚¬ìš©ë˜ëŠ” ì¿¼ë¦¬ì— **ì»¤ì„œë¡œ í™œìš©ë  ì»¬ëŸ¼ìœ¼ë¡œ ì–´ë–¤ ì»¬ëŸ¼ì„ ì§€ì •í• ì§€ ëª¨í˜¸í•˜ë‹¤** ëŠ” ë¬¸ì œì ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§•ì€ ë‹¤ìŒì— ì–´ë–¤ í˜ì´ì§€ë¥¼ ì½ì–´ë“¤ì¼ì§€ ì•Œ ìˆ˜ ìˆë„ë¡ ì»¤ì„œ ê°’ì„ í´ë¼ì´ì–¸íŠ¸ê°€ ì €ì¥í•œë‹¤ê³  í–ˆì—ˆì£ . ê·¸ëŸ°ë°, ë§Œì•½ ì»¤ì„œ ê°’ì´ ìœ ë‹ˆí¬(Unique) í•˜ì§€ ì•Šê³  ì¤‘ë³µë˜ëŠ” ê°’ì´ ì¡´ì¬í•œë‹¤ë©´ ì–´ë–¤ ë¬¸ì œê°€ ë°œìƒí• ê¹Œìš”? ì•„ë˜ ì¿¼ë¦¬ë¥¼ ë‹¤ì‹œ ì‚´í´ë´…ì‹œë‹¤.

```sql
SELECT name, description, created_at, start_date, end_date
FROM trip_schedule
WHERE created_at < {ì»¤ì„œê°’}
  AND created_at >= '2020-01-01'
  AND created_at <= '2020-06-01'
  AND is_private = false
ORDER BY created_at DESC
LIMIT 30;
```

ë³´ë“¯ì´ `created_at` ì´ ì»¤ì„œë¡œ í™œìš©ë˜ê³  ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ, `created_at` ì€ í”Œë˜ë„ˆ ì—¬í–‰ ì¼ì • ë“±ë¡ë‚ ì§œë¡œ, ìœ ë‹ˆí¬(Unique) í•˜ë‹¤ëŠ” ë³´ì¥ì´ ì—†ìŠµë‹ˆë‹¤. ë§Œì•½ì— í˜„ì¬ ì»¤ì„œê°’ì— í™œìš©ë˜ëŠ” created_at ì— 2020-03-10 ì´ í• ë‹¹ëœ ìƒíƒœì´ê³ , ì´ 2020-03-10 ì´ë¼ëŠ” ì¤‘ë³µëœ ê°’ì„ ê°€ì§€ëŠ” ë°ì´í„° ê±´ìˆ˜ê°€ 10ê°œê°€ ë„˜ëŠ”ë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”? ì–´ì©” ìˆ˜ ì—†ì´ MySQL ì¿¼ë¦¬ëŠ” ê·¸ 10ê±´ì˜ ë°ì´í„° ì¤‘ì— ì •í™•íˆ ì–´ë–¤ ë ˆì½”ë“œë¶€í„° ì‹œì‘í•˜ì—¬ LIMIT ê°’ ë§Œí¼ ì½ì–´ì™€ì•¼í• ì§€ ì•Œ ìˆ˜ ì—†ê¸° ë–„ë¬¸ì—, ê·¸ 10ê±´ì¤‘ ì„ì˜ë¡œ í•œ ë°ì´í„°ë¥¼ ì½ì–´ì˜¬ ìˆ˜ ë°–ì— ì—†ìŠµë‹ˆë‹¤. ì¦‰, ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§•ì—ì„œ **ì»¤ì„œ ê°’ì€ ë°˜ë“œì‹œ ìœ ë‹ˆí¬(Unique) í•´ì•¼ í•˜ì§€ë§Œ, ì¿¼ë¦¬ íŠ¹ì„±ìƒ created_at ì€ ìœ ë‹ˆí¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.**

ê·¸ë ‡ë‹¤ë©´ ì»¤ì„œ ê°’ì„ ì¤‘ë³µë˜ì§€ ì•Šì€ ìœ ë‹ˆí¬í•œ ì»¬ëŸ¼ì„ ì„ íƒí•˜ë©´ ë¬¸ì œê°€ í•´ê²°ë  ê²ƒì…ë‹ˆë‹¤. ì´ë¥¼ìœ„í•´ PK ì»¬ëŸ¼ì— ëŒ€í•´ ì»¤ì„œë¡œ ì§€ì •í•´ë³¼ ìˆ˜ ìˆê² ì£ . í•˜ì§€ë§Œ, BETWEEN ì ˆë¡œ ì •ë ¬ë˜ëŠ” ê²°ê³¼ë¬¼ì˜ ì—¬í–‰ ì¼ì • ë¦¬ìŠ¤íŠ¸ëŠ” PK ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì •ë ¬ë˜ì§€ ì•Šê³ , created_at ì„ ê¸°ë°˜ìœ¼ë¡œ ì •ë ¬ë©ë‹ˆë‹¤. ì¦‰, ìœ„ ì¿¼ë¦¬ì—ì„œ **ORDER BY** ì ˆì„ í†µí•´ created_at ë¡œ ì •ë ¬ëœ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ì—ì„œ PK ì˜ í¬ê¸°ëŠ” ì„œë¡œ ë’¤ì£½ë°•ì£½ ì´ë¼ëŠ” ì ì…ë‹ˆë‹¤. ë”°ë¼ì„œ PK ëŠ” ì»¤ì„œë¡œ í™œìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì •ë¦¬í•˜ìë©´, ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§•ì€ íŠ¹ì • ì»¬ëŸ¼ì— ì˜ì¡´í•˜ì—¬ ë°ì´í„°ë¥¼ ì •ë ¬í•˜ê¸° ë•Œë¬¸ì—, **ê³ ìœ í•˜ì§€ ì•Šì€ í•„ë“œë¡œ ì •ë ¬í•  ê²½ìš°, ì»¤ì„œ ê°’ì´ ì¤‘ë³µ**ë  ê°€ëŠ¥ì„±ì´ ìˆì–´ ë°ì´í„°ê°€ ëˆ„ë½ë˜ê±°ë‚˜ ì¤‘ë³µë  ìˆ˜ ìˆë‹¤ëŠ” ë¬¸ì œì ì´ ë°œìƒí•©ë‹ˆë‹¤. (ì‚¬ì‹¤ ì»¤ì„œë¡œ `created_at` ì™¸ì—ë„ `PK` ì»¬ëŸ¼ì„ ë™ì‹œì— 2ê°œë¥¼ ì‚¬ìš©í•˜ë©´ ë¬¸ì œê°€ ì—†ê¸´í•©ë‹ˆë‹¤. ë‹¤ë§Œ, ê·¸ë§Œí¼ ê´€ë¦¬ì˜ ë³µì¡ì„±ì´ ë†’ì•„ì§€ê¸´ í•˜ì£ .)

ì´ëŸ¬í•œ ì´ìœ ë¡œ, ì €í¬ ì„œë¹„ìŠ¤ì˜ **ìš”êµ¬ì‚¬í•­ íŠ¹ì„±ìƒ ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§•ì„ ë„ì…í•˜ê¸°ì—” ì–´ë µë‹¤ëŠ”** ê²°ë¡ ì„ ë‚´ë¦¬ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ë¹„ìŠ·í•œ ì´ìœ ë¡œ, ì—­ë°©í–¥ í˜ì´ì§•ë„ ì–´ë µê³ , í´ëŸ¬ì´ì–¸íŠ¸ì™€ ì„œë²„ ì–‘ì¸¡ ëª¨ë‘ ì»¤ì„œ ê´€ë¦¬ì˜ ë¶€ë‹´ì´ ì»¤ì§€ë©°, ì»¤ì„œë¥¼ ììœ ë¡­ê²Œ ì´ë™í•˜ë©´ì„œ ì—¬í–‰ ì¼ì •ì„ í¸í•˜ê²Œ ì¡°íšŒí•  ìˆ˜ ì—†ë‹¤ëŠ” ë¬¸ì œì ì´ ì¡´ì¬í•˜ë¯€ë¡œ ë„ì…í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

## ğŸ¯ ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•œ ì¿¼ë¦¬ ì„±ëŠ¥ ìµœì í™”

ì•ì„œ ì„¤ëª…í–ˆë“¯ì´, ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§• ë˜ëŠ” ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ì´ë²ˆ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤ê³  í–ˆìŠµë‹ˆë‹¤. ì €í¬ëŠ” ê²°ë¡ ì ìœ¼ë¡œ ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§• ë°©ì‹ì´ ì•„ë‹Œ ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ì¿¼ë¦¬ ì„±ëŠ¥ ë¬¸ì œë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤.

ì»¤ë²„ë§ ì¸ë±ìŠ¤ëŠ” [MySQL ì¸ë±ìŠ¤ ë ˆì¸ì§€ ìŠ¤ìº”ì„ í†µí•œ ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ ê¸°](https://kakaotech-harmony.netlify.app/backend/index-range-scan-improvement/) ì—ì„œë„ ë‹¤ë£¨ì—ˆë“¯ì´, **Random I/O ìì²´ë¥¼ ì™„ì „íˆ ì œê±°**í•´ë²„ë¦´ ìˆ˜ ìˆëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ì»¤ë²„ë§ ì¸ë±ìŠ¤ë€ ì¿¼ë¦¬ë‚´ì— ìˆ˜í–‰ë˜ëŠ” ëª¨ë“  ì»¬ëŸ¼ì„ ë³µí•© ì¸ë±ìŠ¤ê°€ ëª¨ë‘ í¬í•¨í•˜ê³  ìˆëŠ” ì¸ë±ìŠ¤ë¥¼ ëœ»í•œë‹¤ê³  í–ˆì—ˆì£ . ì´ ê²½ìš° ì¸ë±ìŠ¤ ì´ ê²½ìš° ì¸ë±ìŠ¤ê°€ í•„ìš”ë¡œí•˜ëŠ” ëª¨ë“  ë°ì´í„°ë¥¼ ì´ë¯¸ ê°€ì§€ê³  ìˆê¸° ë–„ë¬¸ì—, ì‹¤ì œ ë ˆì½”ë“œì— ì ‘ê·¼í•˜ì—¬ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ëŠ” ëœë¤ I/O ê°€ ì ˆëŒ€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì„±ëŠ¥ì´ ë§¤ìš° ë¹¨ë¼ì§‘ë‹ˆë‹¤.

ì¿¼ë¦¬ ì„±ëŠ¥ ë¬¸ì œê°€ ë°œìƒí–ˆë˜ ì¿¼ë¦¬ë¥¼ ì•„ë˜ì²˜ëŸ¼ ë‹¤ì‹œ ì‚´í´ë´…ì‹œë‹¤. ì´ì „ì—ëŠ” `created_at` ì— ëŒ€í•´ì„œë§Œ ë‹¨ì¼ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•´ì£¼ì—ˆë‹¤ë©´, ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ìœ„í•´ ì´ë²ˆì—” `created_at` ì€ ëª°ë¡  SELECT ì ˆì—ì„œ ì‚¬ìš©ë˜ëŠ” ëª¨ë“  ì»¬ëŸ¼ì„ ë³µí•© ì¸ë±ìŠ¤ì— í¬í•¨ì‹œì¼œ ì£¼ë„ë¡ í•´ì•¼í•©ë‹ˆë‹¤.

```sql
SELECT name, description, created_at, start_date, end_date, created_at
FROM trip_schedule
WHERE created_at >= '2020-01-01' AND created_at <= '2020-06-01' AND is_private = false
ORDER BY created_at DESC
LIMIT 30 OFFSET 5000;
```

ì‹¤ì œë¡œ ì €í¬ íŒ€ì€ ì•„ë˜ì™€ ê°™ì´ ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•¨ìœ¼ë¡œì¨, OFFSET ìœ¼ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” ì¿¼ë¦¬ ì„±ëŠ¥ ë¬¸ì œë¥¼ í•´ê²°í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë¡œì¨ OFFSET ìœ¼ë¡œ ì¸í•´ Random I/O ê°€ ë°œìƒí•˜ëŠ” ì¼ì„ ìµœì†Œí•  ìˆ˜ ìˆê² ì£ ?

```sql
ALTER TABLE trip_schedule
ADD INDEX trip_schedule_covering_idx(created_at, is_private, name, description, start_date, end_date);
```

### ì„±ëŠ¥ ê°œì„  í™•ì¸

ì„±ëŠ¥ ê°œì„  ì •ë„ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´, Jmeter ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ API ì˜ í‰ê·  ì‘ë‹µì‹œê°„ì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤. 1ì´ˆ ê°„ê²©ìœ¼ë¡œ 100ë²ˆì˜ ìš”ì²­ì„ ë³´ë‚´ í‰ê·  ì‘ë‹µ ì‹œê°„ì„ ëƒˆìŠµë‹ˆë‹¤. ë˜í•œ MySQL ì˜ ì‹¤í–‰ê³„íšì„ ì¸¡ì •í•˜ì—¬ ìˆœìˆ˜í•˜ê²Œ ì¿¼ë¦¬ ì„±ëŠ¥ì´ ì–´ëŠì •ë„ë¡œ ê°œì„ ë˜ì—ˆëŠ”ì§€ ë˜í•œ ì¸¡ì •í•˜ì˜€ìŠµë‹ˆë‹¤. Page ê°’ì€ ì„ì˜ë¡œ ì•½ 10ë§Œì„ ë¶€ì—¬í•˜ì˜€ìŠµë‹ˆë‹¤.

### ì„±ëŠ¥ ê°œì„  ì „

ìš°ì„  í”Œë˜ë„ˆ API í˜¸ì¶œ í‰ê·  ì‘ë‹µì‹œê°„ì€ `4,637ms` ê°€ ì¸¡ì •ë˜ì—ˆë„¤ìš”. ì‹¬ì§€ì–´ ê°„í˜¹ Conneciton Timeout ìœ¼ë¡œ ì¸í•´ ì• ëŸ¬ìœ¨ì´ ì•½ 6.8%ë¼ëŠ” ìˆ˜ì¹˜ê°€ ë„ì¶œë˜ê¸°ë„ í–ˆìŠµë‹ˆë‹¤. ìƒí™©ì— ë”°ë¼ íƒ€ì„ì•„ì›ƒì´ ë°œìƒí•˜ê³ , í‰ê·  4.6ì´ˆ ì´ìƒì´ë‚˜ ê¸°ë‹¤ë ¤ì•¼í•˜ëŠ” ì‘ë‹µì‹œê°„ì„ ë°›ëŠ” ì‚¬ìš©ì ì…ì¥ì—ì„  í° ë¶ˆí¸í•¨ì„ ëŠë‚„ ìˆ˜ ë°–ì— ì—†ì„ ê²ƒì…ë‹ˆë‹¤.

![alt text](image-6.png)

### ì„±ëŠ¥ ê°œì„  í›„

ì„±ëŠ¥ ê°œì„  í›„ì—ëŠ” ë†€ë¼ìš´ ë³€í™”ê°€ ì¼ì–´ë‚¬ìŠµë‹ˆë‹¤. ê¸°ì¡´ 4.6ì´ˆì˜ í‰ê·  ì‘ë‹µì‹ë‚˜ì´ 522ms, ì¦‰ 0.52ì´ˆë¼ëŠ” í‰ê·  ì‘ë‹µì‹œê°„ìœ¼ë¡œ í¬ê²Œ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë¡œì¨ Random I/O ë°œìƒ ìœ ë¬´ ì°¨ì´ê°€ ì–¼ë§ˆë‚˜ ì„±ëŠ¥ì— í° ì˜í–¥ì„ ë¼ì¹˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆì£ . í˜ì´ì§€ë„¤ì´ì…˜ ë¡œì§ì—ì„œ ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ì ìš©í•œ ì¿¼ë¦¬ íŠœë‹ ë°©ë²•ì€ API í˜¸ì¶œì— **ì•½ 8.8ë°° ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤.**

![alt text](image-5.png)

MySQL ì‹¤ì œ ì¿¼ë¦¬ ì‘ë‹µì†ë„ ë˜í•œ ì§ì ‘ í™•ì¸í•œ ê²°ê³¼, ì¿¼ë¦¬ íŠœë‹ í›„ ì‘ë‹µì†ë„ê°€ 17ms ê°€ ì¸¡ì •ë˜ì—ˆë„¤ìš”. ê¸°ì¡´ ì„±ëŠ¥ ê°œì„ ì „ì— **ì•½ 36.838ì´ˆê°€ ì†Œìš”ëœê²ƒì— ë¹„í•´ 0.017ì´ˆë¡œ ê·¹ëª…í•˜ê²Œ ê°œì„ **ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

![alt text](image-8.png)

## ë§ˆì¹˜ë©°

ì´ë ‡ê²Œ í˜ì´ì§€ë„¤ì´ì…˜ì—ì„œ ë°œìƒí•˜ëŠ” OFFSET ìœ¼ë¡œ ì¸í•œ ì¿¼ë¦¬ ì„±ëŠ¥ ì´ìŠˆë¥¼ í•´ê²°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì €í¬ ì„œë¹„ìŠ¤ ìš”êµ¬ì‚¬í•­ì— ì•Œë§ê²Œ ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§• ë°©ì‹ê³¼ ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ í†µí•œ 2ê°€ì§€ ë°©ì‹ì„ ë¹„êµí—€ìœ¼ë©°, ê²°êµ­ ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ í†µí•œ ì„±ëŠ¥ ê°œì„ ì„ ì´ë£¨ì–´ë‚¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë¬´ì—‡ë³´ë‹¤ Random I/O ê°€ ë°œìƒí•¨ìœ¼ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” ì„±ëŠ¥ ì €í•˜ê°€ ìƒê°ë³´ë‹¤ í¬ë‹¤ëŠ” ê²ƒì„ ì´ë²ˆ ê¸°íšŒì— ì§ì ‘ ì²´ê°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ë‹¤ë§Œ, ì§€ê¸ˆì˜ ê°œì„  êµ¬ì¡°ëŠ” ì™„ë²½í•œ êµ¬ì¡°ê°€ ì•„ë‹ˆë¼ëŠ” ì ì…ë‹ˆë‹¤. ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§• ë°©ì‹ì—ì„œë„ ë¬¸ì œì ì´ ì¡´ì¬í•˜ë“¯ì´, ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ í†µí•´ ì¿¼ë¦¬ íŠœë‹ ë°©ì‹ ëª°ë¡  ë¬¸ì œì ì´ ì¡´ì¬í•˜ì£ . ì§€ë‚œ í¬ìŠ¤íŒ…ì—ì„œ ì»¤ë²„ë§ ì¸ë±ìŠ¤ê°€ ì•„ë‹Œ ë‹¨ì¼ ì¸ë±ìŠ¤ë¥¼ ë„ì…í–ˆë˜ ì´ìœ ì²˜ëŸ¼, **ì»¤ë²„ë§ ì¸ë±ìŠ¤ëŠ” ë¬´í„±ëŒ€ê³  ë„ì…í•˜ëŠ” ê²ƒì´ ì¢‹ì€ ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤.** ê²°êµ­ ì¿¼ë¦¬ì˜ ëª¨ë“  í•­ëª©ì´ í¬í•¨ë˜ê¸° ë–„ë¬¸ì— ì¸ë±ìŠ¤ í¬í‚¤ê°€ ì»¤ì§ˆ ìˆ˜ ìˆê³ , ì•„ë¬´ë¦¬ ì»¤ë²„ë§ ì¸ë±ìŠ¤ê°€ ë¹ ë¥´ë‹¤ê³  í•œë“¤ ì»¤ë²„ ê¸°ë°˜ í˜ì´ì§• ë°©ì‹ê³¼ ë‹¬ë¦¬ ì†Œìš”ì‹œê°„ì´ O(n) ìœ¼ë¡œ ì„ í˜•ì ìœ¼ë¡œ ì¦ê°€í•˜ëŠ” ë¬¸ì œëŠ” ì—¬ì „ì´ ì¡´ì¬í•˜ê¸´ í•©ë‹ˆë‹¤. ë‹¤ë§Œ, ê·¸ëŸ¼ì—ë„ ì»¤ë²„ ê¸°ë°˜ í˜ì´ì§• ë°©ì‹ì— ë¹„í•´ ë” ì¢‹ì€ ì´ì ë“¤ë„ ì¡´ì¬í•˜ê¸° ë–„ë¬¸ì— ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í•´ìŠµë‹ˆë‹¤. ê²Œë‹¤ê°€ ì†Œìš”ì‹œê°„ì´ ì„ í˜•ì ìœ¼ë¡œ ì¦ê°€í•˜ê² ì§€ë§Œ, í° ê°’ì„ ê°€ì§€ëŠ” OFFSET ì´ ë“±ì¥í•œë‹¤ê³  í•œë“¤ ëŒ€ë¶€ë¶„ ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¡œ ìµœì í™”ë˜ì–´ ë¹ ë¥¸ ì„±ëŠ¥ì´ ë„ì¶œë©ë‹ˆë‹¤.

ì§€ê¸ˆë³´ë‹¤ ë” ì¢‹ì€ ë°©ë²•ì´ ë˜ ìˆì„ì§€, ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§• ë°©ì‹ì™¸ì—ë„ ë‹¤ë¥¸ ë°©ì‹ë„ ì¡´ì¬í•˜ëŠ”ì§€ë¥¼ ê³„ì† ê³ ë¯¼í•´ë³´ëŠ” ì‹œê°„ì„ ê°€ì ¸ë³¼ê¹Œ í•©ë‹ˆë‹¤. ê·¸ëŸ¼ ì´ë§Œ í¬ìŠ¤íŒ…ì„ ë§ˆì³ë³´ê² ìŠµë‹ˆë‹¤ ğŸ˜

## ì°¸ê³ 

- https://jojoldu.tistory.com/529?category=637935
- https://jojoldu.tistory.com/528
- https://jojoldu.tistory.com/476
- https://oneny.tistory.com/110
- https://taegyunwoo.github.io/tech/Tech_DBPagination
- https://velog.io/@ppinkypeach/ì»¤ë²„ë§-ì¸ë±ìŠ¤ë¥¼-í™œìš©í•œ-Offset-ê¸°ë°˜-í˜ì´ì§€ë„¤ì´ì…˜-ì„±ëŠ¥-ê°œì„ 
- https://chem-coder.tistory.com/186
